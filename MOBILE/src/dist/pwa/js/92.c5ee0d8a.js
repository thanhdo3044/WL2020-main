(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[92],{"676b":function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-page",{staticClass:"q-pa-md"},[!0===this.$store.state.production.loadItemsDone?o("div",[o("app-bar",[e._v("Tạo pallet")]),o("div",{staticClass:"row justify-center"},[o("div",{staticClass:"col-12 col-md-6 q-ma-md"},[o("info-factoryfsc"),o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{clearable:"",behavior:"dialog",options:e.woodTypes,label:"Loại gỗ"},model:{value:e.woodType,callback:function(t){e.woodType=t},expression:"woodType"}})],1)]),e.requireSelectLSX?o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{clearable:"",behavior:"dialog",options:e.prodOrders,label:"Lệnh sản xuất"},model:{value:e.prodOrder,callback:function(t){e.prodOrder=t},expression:"prodOrder"}})],1)]):o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-input",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{outlined:"",label:"Mã lô gỗ"},on:{blur:e.blurMaLoGo},model:{value:e.parcel,callback:function(t){e.parcel=t},expression:"parcel"}})],1)]),o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{behavior:"dialog",options:e.sources,add:e.changeSource,label:"Bộ phận tạo pallet :"},model:{value:e.sourceSelect,callback:function(t){e.sourceSelect=t},expression:"sourceSelect"}})],1)]),o("div",{directives:[{name:"show",rawName:"v-show",value:e.showSelectDestination,expression:"showSelectDestination"}],staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{behavior:"dialog",options:e.destinations,label:"Nơi xuất đến :"},model:{value:e.destinationSelect,callback:function(t){e.destinationSelect=t},expression:"destinationSelect"}})],1)]),o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{behavior:"dialog",options:e.palletTypes,label:"Loại pallet :"},model:{value:e.palletTypeSelect,callback:function(t){e.palletTypeSelect=t},expression:"palletTypeSelect"}})],1)]),null===this.$store.state.production.materialSelected&&!0===e.requireMaterialSelect?o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{"use-input":"","input-debounce":"0",behavior:"dialog",options:e.materials,label:"Qui cách thô :"},on:{input:e.selectMaterialById,filter:e.searchMaterial},model:{value:e.materialSelected,callback:function(t){e.materialSelected=t},expression:"materialSelected"}})],1)]):e._e(),null===this.$store.state.production.itemChoosed?o("div",{staticClass:"row"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.showSelectItem,expression:"showSelectItem"}],staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{"use-input":"","input-debounce":"0",behavior:"dialog",options:e.items,label:"Qui cách tinh :"},on:{input:e.selectItemById,filter:e.searchItem},model:{value:e.item,callback:function(t){e.item=t},expression:"item"}})],1)]):e._e(),null!==this.$store.state.production.materialSelected&&void 0!==this.$store.state.production.materialSelected.id?o("div",{staticClass:"row justify-center q-mt-md "},[o("div",{staticClass:"col-12"},[o("card-item-in-from",{attrs:{typeMaterial:!0,cardClass:"bg-secondary text-white",removeItem:e.removeMaterial,item:this.$store.state.production.materialSelected}})],1)]):e._e(),o("div",{staticClass:"row justify-center q-mt-md "},[null!==this.$store.state.production.itemChoosed&&void 0!==this.$store.state.production.itemChoosed&&void 0!==this.$store.state.production.itemChoosed.id?o("div",{staticClass:"col-12"},[o("card-item-in-from",{attrs:{removeItem:e.removeItem,item:this.$store.state.production.itemChoosed}})],1):e._e()]),e.validate?o("div",{staticClass:"row justify-center"},[o("div",{staticClass:"col-8 justify-center"},[o("q-btn",{attrs:{color:"primary full-width q-mt-md",glossy:"",label:"Tạo pallet"},on:{click:function(t){e.showConfirm=!0}}})],1)]):e._e()],1)])],1):e._e(),o("div",{staticClass:"row justify-center"},[o("div",{staticClass:"col-6 justify-center"},[o("q-inner-loading",{attrs:{showing:!this.$store.state.production.loadItemsDone,groupItemTypes:this.$store.state.production.groupItems,groupItemTypeSelected:this.$store.state.production.groupItems[0]}},[o("q-spinner-gears",{attrs:{size:"150px",color:"primary"}})],1)],1)]),o("dialog-success",{attrs:{show:e.showSuccess,palletCode:e.palletCode,closeDialog:e.closeDialog}}),o("dialog-add-supplies",{attrs:{show:e.showDialogAddSupplie,toAddSupplies:e.toAddSupplies,close:e.closeConfirmAddSupplie}}),o("q-dialog",{attrs:{persistent:""},model:{value:e.showConfirm,callback:function(t){e.showConfirm=t},expression:"showConfirm"}},[o("q-card",{staticStyle:{"min-width":"300px"}},[o("q-card-section",{staticClass:"row items-center"},[o("span",{staticClass:"prodTextTitle"},[e._v("Bạn đã chắc chắn ?")])]),o("q-card-actions",{attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy",color:"primary"}}),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đồng ý",color:"primary"},on:{click:e.createPallet}})],1)],1)],1)],1)},a=[],s=(o("8e6e"),o("8a81"),o("456d"),o("6b54"),o("9523")),n=o.n(s),r=(o("ac6a"),o("cadf"),o("5df3"),o("a34a")),l=o.n(r),c=(o("96cf"),o("c973")),d=o.n(c),u=(o("551c"),o("06db"),o("7f7f"),o("20d6"),o("7514"),o("28a5"),o("278c")),p=o.n(u),h=(o("f79b"),o("4778")),m=o("427f"),f=o("dd38"),v=o("9fb5"),g=o("075b"),S=o("c0af"),y=o("8e39");o("5918"),o("fa7d");function w(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,i)}return o}function b(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?w(Object(o),!0).forEach((function(t){n()(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):w(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var C="wood-processing",T={components:{"app-bar":f["a"],"info-factoryfsc":h["a"],"card-itempallet":m["a"],"info-supplies":v["a"],"card-item-in-from":g["a"],"dialog-success":S["a"],"dialog-add-supplies":y["a"]},beforeDestroy:function(){console.log("create pallet page destroy"),this.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET_INIT"),this.item=null,this.removeItem()},beforeMount:function(){this.removeItem(),this.removeMaterial()},data:function(){return{items:[],parcel:"",dialog:!1,item:null,loadDone:0,showLoadling:!0,sources:[],sourceSelect:null,destinations:[],destinationSelect:null,palletTypes:[],palletTypeSelect:null,materials:[],materialSelected:null,requireMaterialSelect:!1,validate:!1,showSuccess:!1,palletCode:"",showDialogAddSupplie:!1,showSelectItem:!1,showSelectDestination:!1,showConfirm:!1,prodOrder:null,prodOrders:[],woodType:null,woodTypes:[],lenhsx:"",requireSelectLSX:!0}},computed:{wathValidate:function(){return"".concat(this.sourceSelect,"|").concat(this.destinationSelect,"|").concat(this.palletTypeSelect,"|").concat(this.item,"|").concat(this.materialSelected,"|").concat(this.prodOrder)}},watch:{wathValidate:function(e,t){var o=e.split("|"),i=p()(o,6),a=i[0],s=i[1],n=i[2],r=i[3],l=i[4],c=i[5];"null"!==a&&"null"!==s&&"null"!==n&&"null"!==r?this.requireMaterialSelect?this.validate="null"!==l:"null"!==c&&(this.validate=!0):this.validate=!1},sourceSelect:function(e){if(e){var t=this.$store.getters["base/mySources"],o=t.find((function(t){return t.id===e.value}));this.$store.dispatch("production/ACTION_SELECT_SOURCE",o),this.showSelectItem=!0}},item:function(e){var t=this;if(e){var o={itemId:e.value,token:this.$store.state.production.userInfo.token};this.$store.dispatch("production/ACTION_GET_DESTINATION_BY_ITEM",o).then((function(e){if(t.destinations=[],e.data.length>0){var o=e.data.findIndex((function(e){return e.id===t.sourceSelect.value}));if(o<e.data.length-1){var i={label:e.data[o+1].name,value:e.data[o+1].id};t.destinations.push(i),t.destinationSelect=i}}else t.$q.notify({message:"Sản phẩm này không có định tuyến !"});t.$store.getters["base/myDestinations"].length>0&&t.$store.getters["base/myDestinations"].forEach((function(e){if(-1===t.destinations.findIndex((function(t){return t.value===e.id}))){var o={label:e.name,value:e.id};t.destinations.push(o)}})),t.showSelectDestination=!0}))}}},mounted:function(){var e=this,t=this.$store.getters["base/myFactoryInfor"].id,o=localStorage.getItem("malogo");o&&(this.parcel=o);var i=this.$route.query.type;i?("lp"===i&&(this.requireMaterialSelect=!0,this.requireSelectLSX=!1),"sc"===i&&(this.requireMaterialSelect=!0)):(this.$q.notify({message:"Dữ liệu không chính xác !"}),this.$router.push("/production-dashboard"));var a=new Promise((function(t,o){e.$store.dispatch("production/ACTION_LOAD_WOOD_TYPES",C).then((function(o){o.data.forEach((function(t){var o={label:t.name,value:t.id};e.woodTypes.push(o)})),e.woodTypes.length>0&&(e.woodType=e.woodTypes[0]),t(!0)}))})),s=new Promise((function(o,i){e.$store.dispatch("production/ACTION_FETCH_WOOD_ITEMS",t).then((function(t){e.$store.state.production.woods.forEach((function(t){var o={label:t.height+" "+t.width+" "+t.length+" -> "+t.name,value:t.id};e.materials.push(o)})),o(!0)})).catch((function(e){console.log("Load Material Error :"+e),i(!1)}))})),n=new Promise((function(t,o){var i=e.$store.getters["base/myDepartmentInfor"].packageTypeGroupId||e.$store.getters["base/myXuongInfor"].packageTypeGroupId||e.$store.getters["base/myFactoryInfor"].packageTypeGroupId;e.$store.dispatch("production/ACTION_GET_PACKAGE_TYPE",e.$store.state.production.userInfo.token).then((function(o){e.$store.state.production.packageTypes.forEach((function(t){if(t.typeId===i){var o={label:t.name,value:t.id};e.palletTypes.push(o)}})),t(!0)})).catch((function(e){o(!1)}))})),r=new Promise(function(){var o=d()(l.a.mark((function o(i,a){var s,n;return l.a.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return s={factoryId:t},o.next=3,e.$store.dispatch("production/ACTION_LOAD_PROD_ORDERS",s);case 3:n=o.sent,n.data.forEach((function(t){var o={label:t.name,value:t.id};e.prodOrders.push(o)})),i(!0);case 6:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}()),c=new Promise((function(t,o){var i=e.$store.getters["base/mySources"];i.forEach((function(t){var o={label:t.name,value:t.id};e.sources.push(o)})),e.sources.length>0&&(e.sourceSelect=e.sources[0]),t(!0)})),u=new Promise((function(o,i){if(e.$store.state.production.items.length>0)o(!0);else{var a={factoryId:t};e.$store.dispatch("production/ACTION_FETCH_ITEMS",a).then((function(e){o(!0)})).catch((function(e){console.log(" Load Item Fail !",e),i(!1)}))}}));Promise.all([s,a,n,u,c,r]).then((function(t){console.log(t),e.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET"),e.sources.length>0&&e.destinations.length>0&&(e.sourceSelect=e.sources[0].name,e.destinationSelect=e.destinations[0].name),e.$store.dispatch("production/MERGE_ITEMS_WITH_WOODS")})).catch((function(e){console.log(e)}))},methods:{blurMaLoGo:function(){localStorage.setItem("malogo",this.parcel)},changeSource:function(e){console.log(e)},toAddSupplies:function(){this.$router.push({name:"addcoc",params:{code:this.palletCode}})},closeDialog:function(){this.$store.state.production.userInfo.token,this.palletCode;this.$router.push({name:"addcoc",params:{code:this.palletCode}})},chooseItem:function(){this.$router.push("/production-items")},removeItem:function(){this.$store.dispatch("production/ACTION_REMOVE_ITEM"),this.item=null},removeMaterial:function(){this.$store.dispatch("production/ACTION_REMOVE_MATERIAL_SELECTED"),this.materialSelected=null},selectItemById:function(){this.$store.dispatch("production/ACTION_CHOOSE_ITEM",this.item)},selectMaterialById:function(){this.$store.dispatch("production/ACTION_SELECT_ONE_MATERIAL",this.materialSelected)},createPallet:function(){var e=this,t=!1;if(this.requireMaterialSelect?this.$store.state.production.materialSelected.qty>0&&this.$store.state.production.itemChoosed.qty>0&&(t=!0):this.$store.state.production.itemChoosed.qty>0&&(t=!0),t){var o,i,a=this.$store.state.production.userInfo.token,s=this.sourceSelect.value,n=100081,r=this.$store.state.production.itemChoosed.id,l=this.$store.state.production.itemChoosed.qty,c={},d={},u={token:a,sourceId:s,destinationId:n,itemId:r,quantity:l,productionOrdersId:this.prodOrder?this.prodOrder.value:null,woodTypeId:this.woodType.value};this.requireMaterialSelect&&(o=this.$store.state.production.materialSelected.id,i=this.$store.state.production.materialSelected.qty,d={materialsId:o,materialsQuantity:i,parcel:this.parcel}),c=b(b({},u),d);var p={eventName:"Tạo Pallet",timeStamp:(new Date).toISOString(),status:0,palletCode:"????????",palletType:this.palletTypeSelect.label};this.$store.dispatch("production/ACTION_CREATE_PALLET",c).then((function(t){if(!0===t.meta.success){e.$store.dispatch("production/ACTION_REMOVE_ALL_WOOD"),e.palletCode=t.data[0].code,e.showSuccess=!0,e.removeItem(),e.removeMaterial();var o=e.destinationSelect.value.toString()+"-RECIVED-PALLET",i="Đã nhận được pallet số "+e.palletCode,a="Nhận được pallet từ công đoạn "+e.sourceSelect.label+" chuyển đến công đoạn "+e.destinationSelect.label,s="/#/production-dashboard?code="+e.palletCode;e.$sendFcm(i,a,s,o,{}).then((function(e){console.log("send fcm success",e)})).catch((function(e){console.log("send Error: "+e)})),e.$q.notify({message:"Tạo pallet thành công !",color:"green",position:"top-right"}),p.status=1,p.palletCode=t.data[0].code}else p.status=0,e.$q.notify({message:t.meta.messages.message,color:"red",position:"center"});e.$eventLog(p)}))}else this.$q.notify({message:"Thiếu thông tin, vui lòng kiểm tra lại",color:"red",position:"center"})},closeConfirmAddSupplie:function(){this.showDialogAddSupplie=!1},searchItem:function(e,t){var o=this,i=[];this.$store.state.production.items.forEach((function(e){var t={label:e.name+" -> "+e.height+" "+e.width+" "+e.length,value:e.id};i.push(t)})),t(""!==e?function(){var t=e.toLowerCase();o.items=i.filter((function(e){var o=e.label;if(o.toString().indexOf(t)>-1)return e}))}:function(){o.items=i})},searchMaterial:function(e,t){var o=this,i=[];this.$store.state.production.woods.forEach((function(e){var t={label:e.name+" -> "+e.height+" "+e.width+" "+e.length,value:e.id};i.push(t)})),t(""!==e?function(){var t=e.toLowerCase();o.materials=i.filter((function(e){var o=e.label;if(o.toString().indexOf(t)>-1)return e}))}:function(){o.materials=i})}}},I=T,O=o("2877"),$=o("9989"),E=o("ddd8"),_=o("27f9"),q=o("9c40"),A=o("74f7"),D=o("cf57"),x=o("24e8"),N=o("f09f"),L=o("a370"),M=o("4b7e"),k=o("7f67"),P=o("eebe"),R=o.n(P),j=Object(O["a"])(I,i,a,!1,null,null,null);t["default"]=j.exports;R()(j,"components",{QPage:$["a"],QSelect:E["a"],QInput:_["a"],QBtn:q["a"],QInnerLoading:A["a"],QSpinnerGears:D["a"],QDialog:x["a"],QCard:N["a"],QCardSection:L["a"],QCardActions:M["a"]}),R()(j,"directives",{ClosePopup:k["a"]})}}]);