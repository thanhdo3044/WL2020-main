(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[134],{"996a":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-md"},[!0===this.$store.state.production.loadItemsDone?a("div",[a("app-bar",[e._v("Tạo Số Lô")]),a("div",{staticClass:"row justify-center"},[a("div",{staticClass:"col-12 col-md-6 q-ma-md"},[a("info-factoryfsc"),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{behavior:"dialog",options:e.prodOrders,label:"Lệnh sản xuất"},on:{input:e.changeProdOrder},model:{value:e.prodOrder,callback:function(t){e.prodOrder=t},expression:"prodOrder"}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{behavior:"dialog",options:e.sources,label:"Bộ phận tạo pallet :"},on:{input:e.changeSource},model:{value:e.sourceSelect,callback:function(t){e.sourceSelect=t},expression:"sourceSelect"}})],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showSelectDestination,expression:"showSelectDestination"}],staticClass:"row"},[a("div",{staticClass:"col-12"},[a("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{behavior:"dialog",options:e.destinations,label:"Nơi xuất đến :"},model:{value:e.destinationSelect,callback:function(t){e.destinationSelect=t},expression:"destinationSelect"}})],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{behavior:"dialog",options:e.palletTypes,label:"Loại pallet :"},model:{value:e.palletTypeSelect,callback:function(t){e.palletTypeSelect=t},expression:"palletTypeSelect"}})],1)]),e.itemsSelected.length>0?a("div",{staticClass:"row justify-center"},[a("div",{staticClass:"col-12 q-ma-sm"},[a("q-card",{staticClass:"my-card"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v(e._s(e.itemsSelected[0].name))])]),a("q-card-section",[a("q-input",{attrs:{type:"text",label:"Số lượng đã sản xuất ",disable:!0},model:{value:this.current.quantity,callback:function(t){e.$set(this.current,"quantity",t)},expression:"this.current.quantity"}}),a("br"),a("q-input",{attrs:{type:"text",label:"Số lượng vật liệu đã nhận ",disable:!0},model:{value:this.maxQuantityAvalible,callback:function(t){e.$set(this,"maxQuantityAvalible",t)},expression:"this.maxQuantityAvalible"}}),a("br"),a("q-input",{attrs:{outlined:"",type:"number",label:"Số lượng ghi nhận"},model:{value:e.itemsSelected[0].quantity,callback:function(t){e.$set(e.itemsSelected[0],"quantity",e._n(t))},expression:"itemsSelected[0].quantity"}})],1)],1)],1)]):e._e(),e.validate?a("div",{staticClass:"row justify-center"},[a("div",{staticClass:"col-8 justify-center"},[a("q-btn",{attrs:{color:"primary full-width q-mt-md",glossy:"",label:"Tạo pallet"},on:{click:function(t){e.showConfirm=!0}}})],1)]):e._e()],1)])],1):e._e(),a("dialog-success",{attrs:{show:e.showSuccess,palletCode:e.palletCode,closeDialog:e.closeDialog}}),a("q-dialog",{attrs:{persistent:""},model:{value:e.showConfirm,callback:function(t){e.showConfirm=t},expression:"showConfirm"}},[a("q-card",{staticStyle:{"min-width":"300px"}},[a("q-card-section",{staticClass:"row items-center"},[a("span",{staticClass:"prodTextTitle"},[e._v("Bạn đã chắc chắn ?")])]),a("q-card-actions",{attrs:{align:"right"}},[a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy",color:"primary"}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đồng ý",color:"primary"},on:{click:e.createPallet}})],1)],1)],1)],1)},i=[],s=(a("6b54"),a("ac6a"),a("cadf"),a("5df3"),a("a34a")),o=a.n(s),r=(a("7f7f"),a("96cf"),a("c973")),l=a.n(r),c=(a("551c"),a("06db"),a("7514"),a("20d6"),a("28a5"),a("278c")),u=a.n(c),d=(a("f79b"),a("4778")),p=a("427f"),h=a("dd38"),m=a("9fb5"),f=a("075b"),v=a("c0af"),S=a("8e39"),y=(a("5918"),a("fa7d")),g=a("d30a"),w={components:{"app-bar":h["a"],"info-factoryfsc":d["a"],"card-itempallet":p["a"],"info-supplies":m["a"],"card-item-in-from":f["a"],"dialog-success":v["a"],"dialog-add-supplies":S["a"],DxDataGrid:g["DxDataGrid"],DxColumn:g["DxColumn"],DxEditing:g["DxEditing"],DxLookup:g["DxLookup"],DxRequiredRule:g["DxRequiredRule"],DxPopup:g["DxPopup"],DxPosition:g["DxPosition"],DxForm:g["DxForm"],DxItem:g["DxItem"]},beforeDestroy:function(){console.log("create pallet page destroy"),this.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET_INIT"),this.item=null,this.removeItem()},beforeMount:function(){this.removeItem(),this.removeMaterial()},data:function(){return{items:[],parcel:"",dialog:!1,item:null,loadDone:0,showLoadling:!0,sources:[],sourceSelect:null,destinations:[],destinationSelect:null,palletTypes:[],palletTypeSelect:null,materials:[],materialSelected:null,requireMaterialSelect:!1,validate:!1,showSuccess:!1,palletCode:"",showDialogAddSupplie:!1,showSelectItem:!1,showSelectDestination:!0,showConfirm:!1,prodOrder:null,prodOrders:[],woodType:null,woodTypes:[],lenhsx:"",requireSelectLSX:!0,itemsSelected:[],current:{departmentId:0,quantity:0},currentsData:[],isHoanThien:!1,maxQuantityAvalible:0}},computed:{wathValidate:function(){return"".concat(this.sourceSelect,"|").concat(this.destinationSelect,"|").concat(this.prodOrder)}},watch:{wathValidate:function(e,t){var a=e.split("|"),n=u()(a,5),i=n[0],s=n[1],o=n[2],r=n[3],l=n[4];"null"!==i&&"null"!==s&&"null"!==o&&"null"!==r?this.requireMaterialSelect?"null"!==mSelect?this.validate=!0:this.validate=!1:"null"!==l&&(this.validate=!0):this.validate=!1},item:function(e){},sourceSelect:function(e){this.currentsData.length>0&&-1!==this.currentsData.findIndex((function(t){return t.departmentId===e.value}))&&(this.current=this.currentsData.find((function(t){return t.departmentId===e.value})))}},created:function(){var e=this,t=this.$store.getters["base/myFactoryInfor"].id,a=this.$route.query.type;a&&(this.isHoanThien="ht"===a);var n=new Promise(function(){var a=l()(o.a.mark((function a(n,i){var s;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,e.$store.dispatch("production/ACTION_LOAD_PROD_ORDERS_BY_FACTORY",t);case 2:s=a.sent,s.data.forEach((function(t){var a={label:t.name,value:t.id};e.prodOrders.push(a)})),n(!0);case 5:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}()),i=new Promise((function(t,a){var n=e.$store.getters["base/myStepInfor"].packageTypeGroupId||e.$store.getters["base/myXuongInfor"].packageTypeGroupId||e.$store.getters["base/myFactoryInfor"].packageTypeGroupId;e.$store.dispatch("production/ACTION_GET_PACKAGE_TYPE").then((function(a){e.$store.state.production.packageTypes.forEach((function(t){if(t.typeId===n){var a={label:t.name,value:t.id};e.palletTypes.push(a)}})),t(!0)})).catch((function(e){a(!1)})),t(!0)})),s=new Promise(function(){var e=l()(o.a.mark((function e(t,a){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t(!0);case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());Promise.all([s,n,i]).then((function(t){e.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET");var a=e.$store.getters["base/mySources"],n=e.$store.getters["base/myDestinations"];a.forEach((function(t){var a={label:t.name,value:t.id};e.sources.push(a)})),e.sources.length>0&&(e.sourceSelect=e.sources[0]),n.forEach((function(t){e.destinations.push({value:t.id,label:t.name})})),e.destinations.length>0?e.destinationSelect=e.destinations[0]:e.$q.notify({message:"Tài khoản chưa được cấu hình !"})})).catch((function(e){console.log(e)}))},methods:{changeProdOrder:function(e){var t=this;return l()(o.a.mark((function a(){return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.loadProdInLSX(e.value);case 2:case"end":return a.stop()}}),a)})))()},loadProdInLSX:function(e){var t=this;return l()(o.a.mark((function a(){var n,i,s,r;return o.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.$q.loading.show({message:"Chờ 1 chút ...",messageColor:"white"}),a.next=3,t.$store.dispatch("wood/LOAD_MATERIAL_IN_PROD",e);case 3:n=a.sent,t.currentsData=n.data.current,[],t.sourceSelect&&(-1!==t.currentsData.findIndex((function(e){return e.departmentId===t.sourceSelect.value}))?(i=t.currentsData.findIndex((function(e){return e.departmentId===t.sourceSelect.value})),t.current=t.currentsData[i],s=n.data.products[0],i>0?(t.previousCurrent=t.currentsData[i-1],r=t.previousCurrent.quantity-t.current.quantity,t.maxQuantityAvalible=r>0?r:0,s.quantity=t.maxQuantityAvalible):t.maxQuantityAvalible=n.data.products[0].quantity,t.itemsSelected.push(s)):(t.current=[],t.$q.notify({message:"Lệnh sản xuất này chưa có sản phẩm !"}))),t.$q.loading.hide();case 8:case"end":return a.stop()}}),a)})))()},initNewRow:function(){},insertedRow:function(){},onEditorPreparing:function(e){"itemId"===e.dataField&&(e.editorOptions.disabled=!0)},insertingRow:function(){},blurMaLoGo:function(){},changeSource:function(e){var t=this;return l()(o.a.mark((function e(){return o.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.maxQuantityAvalible=0,e.next=3,t.loadProdInLSX(t.prodOrder.value);case 3:case"end":return e.stop()}}),e)})))()},toAddSupplies:function(){},closeDialog:function(){this.showSuccess=!1,this.prodOrder=null,this.itemsSelected=[]},chooseItem:function(){this.$router.push("/production-items")},removeItem:function(){this.$store.dispatch("production/ACTION_REMOVE_ITEM"),this.item=null},removeMaterial:function(){this.$store.dispatch("production/ACTION_REMOVE_MATERIAL_SELECTED"),this.materialSelected=null},selectItemById:function(){this.$store.dispatch("production/ACTION_CHOOSE_ITEM",this.item)},selectMaterialById:function(){this.$store.dispatch("production/ACTION_SELECT_ONE_MATERIAL",this.materialSelected)},createPallet:function(){var e=this,t=!1;if(1===this.itemsSelected.length&&this.itemsSelected[0].quantity>this.maxQuantityAvalible&&(this.$q.notify({message:"Số lượng không chính xác !"}),t=!1),t){var a=this.sourceSelect.value,n=this.destinationSelect.value,i=this.itemsSelected[0].id,s=this.itemsSelected[0].quantity,o={sourceId:a,destinationId:n,itemId:i,quantity:s,productionOrdersId:this.prodOrder.value},r={eventName:"Tạo Pallet",timeStamp:(new Date).toISOString(),status:0,palletCode:"????????",palletType:this.prodOrder.label};this.$store.dispatch("production/ACTION_CREATE_PALLET",o).then((function(t){if(!0===t.meta.success){e.palletCode=t.data[0].code,e.showSuccess=!0,e.removeItem(),e.removeMaterial();var a=e.destinationSelect.value.toString()+"-RECIVED-PALLET",n="Đã nhận được pallet số "+e.palletCode,i="Nhận được pallet từ công đoạn "+e.sourceSelect.label+" chuyển đến công đoạn "+e.destinationSelect.label,s="/#/production-dashboard?code="+e.palletCode;e.$sendFcm(n,i,s,a,{}).then((function(e){console.log("send fcm success",e)})).catch((function(e){console.log("send Error: "+e)})),Object(y["o"])(),r.status=1,r.palletCode=t.data[0].code}else r.status=0,e.$q.notify({message:t.meta.messages.message,color:"red"});e.$eventLog(r)}))}else this.$q.notify({message:"Thiếu thông tin, vui lòng kiểm tra lại",color:"red"})},closeConfirmAddSupplie:function(){this.showDialogAddSupplie=!1},searchItem:function(e,t){var a=this,n=[];this.$store.state.production.items.forEach((function(e){var t={label:e.name+" -> "+e.height+" "+e.width+" "+e.length,value:e.id};n.push(t)})),t(""!==e?function(){var t=e.toLowerCase();a.items=n.filter((function(e){var a=e.label;if(a.toString().indexOf(t)>-1)return e}))}:function(){a.items=n})},searchMaterial:function(e,t){var a=this,n=[];this.$store.state.production.woods.forEach((function(e){var t={label:e.name+" -> "+e.height+" "+e.width+" "+e.length,value:e.id};n.push(t)})),t(""!==e?function(){var t=e.toLowerCase();a.materials=n.filter((function(e){var a=e.label;if(a.toString().indexOf(t)>-1)return e}))}:function(){a.materials=n})}}},b=w,x=a("2877"),C=a("9989"),I=a("ddd8"),D=a("27f9"),T=a("f09f"),q=a("a370"),E=a("9c40"),O=a("24e8"),A=a("4b7e"),_=a("7f67"),$=a("eebe"),L=a.n($),P=Object(x["a"])(b,n,i,!1,null,null,null);t["default"]=P.exports;L()(P,"components",{QPage:C["a"],QSelect:I["a"],QInput:D["a"],QCard:T["a"],QCardSection:q["a"],QBtn:E["a"],QDialog:O["a"],QCardActions:A["a"]}),L()(P,"directives",{ClosePopup:_["a"]})}}]);