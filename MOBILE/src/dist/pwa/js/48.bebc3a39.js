(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[48],{"574c":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"q-pa-sm"},[n("q-input",{attrs:{outlined:"",dense:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),n("old-tasks"),e.pos(null).length?n("q-list",{attrs:{separator:"",bordered:""}},[e._l(e.pos(e.searchQuery).filter((function(t){return!e.isDongBoPhoi(t.itemId)})),(function(t,a){return n("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:""},on:{click:function(n){return e.showConfirmDialog(t.itemId,t.conThucHien)}}},[n("q-item-section",[n("q-item-label",{staticClass:"text-subtitle2"},[e._v("\n          "+e._s(t.itemName)+" ("+e._s(t.itemHeight)+"*"+e._s(t.itemWidth)+"*"+e._s(t.itemLength)+")\n        ")]),n("q-item-label",{attrs:{caption:"",lines:"2"}},[n("q-badge",{attrs:{color:e.isDongBoPhoi(t.itemId)?"teal":"orange-10"}},[e._v("\n            "+e._s(t.root)+"\n          ")])],1)],1),n("q-item-section",{attrs:{side:"",top:""}},[n("q-badge",{attrs:{color:e.isDongBoPhoi(t.itemId)?"teal":"orange-10",label:t.conThucHien}})],1)],1)})),e._l(e.pos(e.searchQuery).filter((function(t){return e.isDongBoPhoi(t.itemId)})),(function(t,a){return n("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:""},on:{click:function(n){return e.showConfirmDialog(t.itemId,t.conThucHien)}}},[n("q-item-section",[n("q-item-label",{staticClass:"text-subtitle2"},[e._v("\n          "+e._s(t.itemName)+" ("+e._s(t.itemHeight)+"*"+e._s(t.itemWidth)+"*"+e._s(t.itemLength)+")\n        ")]),n("q-item-label",{attrs:{caption:"",lines:"2"}},[n("q-badge",{attrs:{color:e.isDongBoPhoi(t.itemId)?"teal":"orange-10"}},[e._v("\n            "+e._s(t.root)+"\n          ")])],1)],1),n("q-item-section",{attrs:{side:"",top:""}},[n("q-badge",{attrs:{color:e.isDongBoPhoi(t.itemId)?"teal":"orange-10",label:t.conThucHien}})],1)],1)}))],2):n("no-tasks"),n("div",{staticClass:"inline rounded-borders cursor-pointer",staticStyle:{"max-width":"300px"}},[n("div",{staticClass:"fit flex flex-center text-center non-selectable q-pa-md"},[e._v("\n      Công đoạn: ("+e._s(e.congdoan.name)+")\n    ")]),n("q-menu",{attrs:{"touch-position":""}},[n("q-list",{staticStyle:{"min-width":"100px"}},e._l(e.myDepartments,(function(t){return n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.id,attrs:{clickable:""}},[n("q-item-section",{on:{click:function(n){return e.chonCongdoan(t)}}},[e._v("\n            "+e._s(t.name)+"\n          ")])],1)})),1)],1)],1),n("q-dialog",{attrs:{maximized:!1},model:{value:e.card,callback:function(t){e.card=t},expression:"card"}},[e.po?n("q-card",{staticClass:"my-card"},[n("q-card-section",[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",flat:"",icon:"keyboard_arrow_left",label:"Trở lại"}}),n("q-input",{attrs:{readonly:!0,type:"text",label:"Sản phẩm/Chi tiết"},model:{value:e.po.itemName,callback:function(t){e.$set(e.po,"itemName",t)},expression:"po.itemName"}}),n("div",{staticClass:"row"},[n("div",{staticClass:"col-4",attrs:{align:"center"}},[n("q-input",{attrs:{readonly:!0,type:"text",label:"Dầy"},model:{value:e.po.itemHeight,callback:function(t){e.$set(e.po,"itemHeight",t)},expression:"po.itemHeight"}})],1),n("div",{staticClass:"col-4",attrs:{align:"center"}},[n("q-input",{attrs:{readonly:!0,type:"text",label:"Rộng"},model:{value:e.po.itemWidth,callback:function(t){e.$set(e.po,"itemWidth",t)},expression:"po.itemWidth"}})],1),n("div",{staticClass:"col-4",attrs:{align:"center"}},[n("q-input",{attrs:{readonly:!0,type:"text",label:"Dài"},model:{value:e.po.itemLenght,callback:function(t){e.$set(e.po,"itemLenght",t)},expression:"po.itemLenght"}})],1)]),n("q-list",{staticClass:"bg-green-3"},[n("q-item-label",{attrs:{header:""}},[e._v("Phôi có thể xuất")]),e._l(e.po.nguyenLieu,(function(t,a){return n("div",{key:t.ITEM_ID},[n("q-separator"),n("q-item",[n("q-item-section",[n("q-item-label",{attrs:{caption:"",lines:"2"}},[e._v(e._s(t.NAME)+"\n                  "+e._s(t.HEIGHT*t.WIDTH*t.LENGTH)+":\n                  "),n("q-badge",{attrs:{label:t.ton}})],1)],1)],1)],1)}))],2),n("q-input",{attrs:{readonly:!1,type:"number",label:"Số lượng lỗi"},model:{value:e.defectQty,callback:function(t){e.defectQty=e._n(t)},expression:"defectQty"}}),n("q-list",{staticClass:"bg-red-3"},[n("q-input",{attrs:{readonly:!0,color:"red",type:"text",label:"Lỗi công đoạn"},model:{value:e.po.loiCongDon,callback:function(t){e.$set(e.po,"loiCongDon",t)},expression:"po.loiCongDon"}})],1),n("q-input",{attrs:{readonly:!0,type:"text",label:"Công đoạn nhận"},model:{value:e.po.stepNextName,callback:function(t){e.$set(e.po,"stepNextName",t)},expression:"po.stepNextName"}}),n("q-input",{attrs:{readonly:!0,type:"number",label:"Số tồn có thể xuất"},model:{value:e.tongton,callback:function(t){e.tongton=e._n(t)},expression:"tongton"}}),n("q-input",{attrs:{value:e.ghinhan,readonly:!0,type:"text",label:"Số lượng còn phải sản xuất"}}),n("q-input",{attrs:{type:"number",label:"Số lượng ghi nhận"},model:{value:e.confirmQty,callback:function(t){e.confirmQty=e._n(t)},expression:"confirmQty"}})],1),n("q-separator"),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{color:"primary",flat:"",label:"Ghi nhận"},on:{click:function(t){e.secondDialog=!0}}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đóng"}})],1)],1):e._e()],1),n("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:e.secondDialog,callback:function(t){e.secondDialog=t},expression:"secondDialog"}},[n("q-card",{staticStyle:{width:"300px"}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("Xác nhận")])]),n("q-card-section",{staticClass:"q-pt-none"},[e.confirmQty?n("p",[e._v("\n          Ghi nhận sản lượng:\n          "),n("q-badge",{attrs:{color:"secondary"}},[e._v(e._s(e.confirmQty))])],1):e._e(),e.description?n("p",[e._v("\n          Dấu tuần: "),n("q-badge",{attrs:{color:"secondary"}},[e._v(e._s(e.description))])],1):e._e(),e.defectQty?n("span",{staticStyle:{color:"red"}},[e._v("Lỗi : "+e._s(e.defectQty))]):e._e()]),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy"}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đồng ý",color:"primary"},on:{click:e.add}})],1)],1)],1),n("DialogSuccess",{attrs:{closeDialog2:e.closeDialog2,palletCode:e.packageString,show:e.showSuccess,closeDialog:e.closeSuccessDialog}})],1)},o=[],i=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("456d"),n("c5f6"),n("7cdf"),n("6762"),n("2fdb"),n("6b54"),n("06db"),n("a481"),n("a34a")),s=n.n(i),r=(n("96cf"),n("c973")),c=n.n(r),l=n("9523"),u=n.n(l),p=(n("7514"),n("2f62")),d=n("fa7d"),h=n("c0af");function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={data:function(){return{maxCoTheGhiNhan:0,tongton:0,secondDialog:!1,congdoan:null,description:"",searchQuery:"",ghinhan:0,tongphoi:[],tongphoi1:0,arr:"",card:!1,task:null,standard:0,showSuccess:!1,packageId:"",confirmQty:"",confirmData:"",target:"",defectQty:"",receiptQty:"",historys:[],lenhsanxuat:"",maxQtyConfirm:0,packageString:"",totalDeliver:0,po:{code:"POac705671-03af-46bd-9a1c-4ff54b527987",daNhanTon:null,stepId:"100277",number:"1111",week:45,year:2020,market:null,ngayDongGoi:"2020-11-02T00:00:00.000Z",factoryId:1e5,keHoach:1,loiCongDon:0,xuatTon:0,stepName:"6.HTD - X3",stepNextId:100282,stepNextName:"8.Đóng gói - X3",order:5,itemId:118579,itemCode:"ID-0045",itemName:"SKOGSTA chopping board 35x20 acacia",itemLenght:350,itemWidth:200,itemHeight:25,UNIT_ID:1e5,target:1,ton:0,quantity:null,error:null,status:"Đang sản xuất"}}},created:function(){var e=this;this.myDepartments.length&&(this.congdoan=this.myDepartments.find((function(t){return t.id==e.$route.query.stepId}))||this.myDepartments[0],this.load(this.congdoan.id)),this.$route.query.code&&this.showConfirmDialog(this.$route.query.code,0)},methods:m(m({},Object(p["b"])("production",["getAllKeHoachSanXuatConLais","getPoByCode","addPackage","getDinhMucs","getTyLeTHs","getlenhsx"])),{},{closeDialog2:function(){var e=this;return c()(s.a.mark((function t(){return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.showSuccess=!1,e.card=!1,e.defectQty="",e.confirmQty="",e.description="";case 5:case"end":return t.stop()}}),t)})))()},closeSuccessDialog:function(){var e=this;this.showSuccess=!1,this.confirmQty="",setTimeout((function(){e.$router.push("/tracking-lot-no?code="+e.packageId)}),1e3)},chonCongdoan:function(e){var t=this;return c()(s.a.mark((function n(){return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.congdoan=e,t.searchQuery="",t.load(e.id),t.$router.replace({path:t.$route.fullPath,query:{stepId:e.id}});case 4:case"end":return n.stop()}}),n)})))()},load:function(e){var t=this;return c()(s.a.mark((function n(){return s.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.getDinhMucs({stepId:e});case 2:return n.next=4,t.getTyLeTHs({stepId:e});case 4:return n.next=6,t.getAllKeHoachSanXuatConLais({stepId:e});case 6:case"end":return n.stop()}}),n)})))()},loadlenhsx:function(e,t){var n=this;return c()(s.a.mark((function a(){return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n.getlenhsx({stepId:e,itemId:t});case 2:n.lenhsanxuat=a.sent;case 3:case"end":return a.stop()}}),a)})))()},unique:function(e){return c()(s.a.mark((function t(){var n,a;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(n=[],a=0;a<e.length;a++)-1===n.indexOf(e[a])&&n.push(e[a]);return t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})))()},showConfirmDialog:function(e,t){var n=this;return c()(s.a.mark((function a(){var o,i;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n.$q.loading.show({message:'Hệ thống đang kiểm tra phôi có thể xuất.<br/><span class="text-primary">Xin vui lòng chờ...</span>'}),a.next=3,n.getlenhsx({stepId:n.congdoan.id,itemId:e});case 3:n.lenhsanxuat=a.sent,n.tongton=0,o=0;case 6:if(!(o<n.lenhsanxuat.length)){a.next=16;break}return i=n.lenhsanxuat[o].code,a.next=10,n.getPoByCode({code1:i});case 10:n.po=a.sent,console.log("con ton:",n.po.conTon),n.tongton+=n.po.conTon;case 13:o++,a.next=6;break;case 16:n.$router.replace({path:n.$route.fullPath,query:{stepId:n.congdoan.id}}),n.ghinhan=t,n.po&&(n.card=!0),n.$q.loading.hide();case 20:case"end":return a.stop()}}),a)})))()},add:function(){var e=this;return c()(s.a.mark((function t(){var n,a,o,i,r,c;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log(e.maxCoTheGhiNhan),n=e.defectQty||0,a=e.confirmQty||0,100273!=e.congdoan.id){t.next=8;break}for(e.maxCoTheGhiNhan=e.po.nguyenLieu[0].ton,o=0;o<e.po.nguyenLieu.length;o++)e.maxCoTheGhiNhan>e.po.nguyenLieu[o].ton&&(e.maxCoTheGhiNhan=e.po.nguyenLieu[o].ton);if(!(e.maxCoTheGhiNhan<n+a)){t.next=8;break}return t.abrupt("return",e.$q.dialog({title:"Lỗi",message:"Không đủ nguyên vật liệu để xuất!"}));case 8:if(!(parseFloat(n)>0)){t.next=11;break}return t.next=11,e.createPackage(100004,n);case 11:if(!(parseFloat(a)>0)){t.next=27;break}console.log("độ dài:",e.lenhsanxuat),i=a,r=0;case 15:if(!(r<e.lenhsanxuat.length)){t.next=27;break}return c=e.lenhsanxuat[r].code,t.next=19,e.getPoByCode({code1:c});case 19:if(e.po=t.sent,!(i>0)){t.next=24;break}return t.next=23,e.createPackage(100026,e.lenhsanxuat[r].conThucHien<i?e.lenhsanxuat[r].conThucHien:i);case 23:i-=e.lenhsanxuat[r].conThucHien;case 24:r++,t.next=15;break;case 27:return console.log("Loa data",e.congdoan.id),t.next=30,e.load(e.congdoan.id);case 30:case"end":return t.stop()}}),t)})))()},createPackage:function(e,t){var n=this;return c()(s.a.mark((function a(){var o,i,r,c;return s.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log(n.po),o=n.po.stepNextId,100004===e&&(i=n.$store.getters["base/mySources"].find((function(e){return e.id===parseInt(n.po.stepId)})),i&&(o=i.error)),r={sourceId:n.po.stepId,destinationId:o,itemId:n.po.itemId,quantity:t,tonconlai:n.tongton,typeId:e,description:n.description,po:n.po.code},a.next=6,n.addPackage(r);case 6:c=a.sent,c.meta.success?(n.packageString=c.data[0].id.toString(),n.packageId=c.data[0].id,n.maxQtyConfirm=n.maxQtyConfirm-parseFloat(t),100026===e&&(n.showSuccess=!0),Object(d["o"])()):Object(d["n"])();case 8:case"end":return a.stop()}}),a)})))()}}),components:{DialogSuccess:h["a"],"no-tasks":n("734f").default,"old-tasks":n("5a7f").default},computed:m(m(m({},Object(p["c"])("base",["myDepartments"])),Object(p["c"])("production",["pos","isDongBoPhoi","tyLeThucHienByItemId"])),{},{getMaxCapPhoi:function(){return 100},isValidate:function(){return!(this.confirmQty&&(!this.po.stepName.toLowerCase().includes("đóng gói")||this.description))&&!(this.defectQty&&(!this.po.stepName.toLowerCase().includes("đóng gói")||this.description))}}),watch:{defectQty:function(e){parseFloat(e)+parseFloat(this.confirmQty||0)>parseFloat((this.lenhsanxuat.conThucHien+this.po.loiCongDon-this.po.quantity).toFixed(6))&&this.$q.dialog({title:"Lỗi",message:"Tổng khối lượng vượt quá kế hoạch!"}),100005===this.po.UNIT_ID||Number.isInteger(e)||this.$q.dialog({title:"Lỗi",message:"Bạn cần nhập số nguyên!"})},confirmQty:function(e){parseFloat(this.defectQty||0)+parseFloat(e)>parseFloat((this.lenhsanxuat.conThucHien+this.po.loiCongDon-this.po.quantity).toFixed(6))&&this.$q.dialog({title:"Lỗi",message:"Tổng khối lượng vượt quá kế hoạch!"}),100005!==this.po.UNIT_ID&&e&&!Number.isInteger(e)&&this.$q.dialog({title:"Lỗi",message:"Bạn cần nhập số nguyên!"})}}},b=f,y=n("2877"),x=n("9989"),v=n("27f9"),q=n("0016"),k=n("1c1c"),w=n("66e5"),D=n("4074"),_=n("0170"),I=n("58a8"),C=n("4e73"),Q=n("24e8"),N=n("f09f"),T=n("a370"),S=n("9c40"),P=n("eb85"),L=n("4b7e"),H=n("714f"),O=n("7f67"),$=n("eebe"),j=n.n($),B=Object(y["a"])(b,a,o,!1,null,null,null);t["default"]=B.exports;j()(B,"components",{QPage:x["a"],QInput:v["a"],QIcon:q["a"],QList:k["a"],QItem:w["a"],QItemSection:D["a"],QItemLabel:_["a"],QBadge:I["a"],QMenu:C["a"],QDialog:Q["a"],QCard:N["a"],QCardSection:T["a"],QBtn:S["a"],QSeparator:P["a"],QCardActions:L["a"]}),j()(B,"directives",{Ripple:H["a"],ClosePopup:O["a"]})},"5a7f":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-banner",{staticClass:"bg-orange text-white",attrs:{dense:"",rounded:""},scopedSlots:e._u([{key:"action",fn:function(){return[n("q-btn",{attrs:{to:"ghi-nhan",flat:"",label:"Dùng thử"}}),n("q-btn",{attrs:{to:"ghi-nhan",flat:"",label:"Đóng"}})]},proxy:!0}])},[e._v("\n  Bạn cần màn hình dễ dàng báo cáo số liệu sản xuất. Ghi nhận một bước theo lệnh/gộp lệnh, theo dõi tồn phôi, lịch sử giao đi.\n  ")])},o=[],i={},s=i,r=n("2877"),c=n("54e1"),l=n("9c40"),u=n("eebe"),p=n.n(u),d=Object(r["a"])(s,a,o,!1,null,null,null);t["default"]=d.exports;p()(d,"components",{QBanner:c["a"],QBtn:l["a"]})}}]);