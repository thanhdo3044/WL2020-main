(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[109],{"5d94":function(t,e,o){"use strict";o.r(e);var s=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",{staticClass:"q-pa-md"},[o("app-bar",[t._v("Tạo pallet xếp sấy")]),this.$store.state.production.loadXepSayDone?o("div",{staticClass:"row justify-center"},[o("div",{staticClass:"col-12 col-md-6 q-ma-md"},[o("info-factoryfsc"),o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{clearable:"",behavior:"dialog",options:t.woodTypes,label:"Loại gỗ"},model:{value:t.woodType,callback:function(e){t.woodType=e},expression:"woodType"}})],1),o("div",{staticClass:"row"},[o("div",{staticClass:"col-12"},[o("q-input",{attrs:{outlined:"",label:"Mã lô gỗ "},on:{input:t.saveLoWoods},model:{value:t.woodsLotNo,callback:function(e){t.woodsLotNo=e},expression:"woodsLotNo"}})],1)]),o("div",{staticClass:"row q-mt-sx"},[o("div",{staticClass:"col-12"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{behavior:"dialog",options:t.palletTypes,label:"Mục đích sấy :"},on:{input:t.changeType},model:{value:t.palletTypeSelect,callback:function(e){t.palletTypeSelect=e},expression:"palletTypeSelect"}})],1)]),o("div",{staticClass:"row q-mt-sm"},[o("div",{staticClass:"col-8"},[o("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{clearable:"","use-input":"","input-debounce":"0",behavior:"dialog",options:t.materials,label:"Qui cách thô :"},on:{input:t.selectItemChoosed,filter:t.searchMaterial},model:{value:t.materialSelected,callback:function(e){t.materialSelected=e},expression:"materialSelected"}})],1),o("div",{staticClass:"col-4"},[o("q-btn",{staticClass:"prodButtonText",staticStyle:{color:"goldenrod",width:"90%",height:"100%","margin-left":"10px"},attrs:{outline:"",label:"Chọn"},on:{click:t.choose}})],1)]),o("div",{staticClass:"row justify-center q-mt-md "},[this.$store.state.production.woodsSelected.length>0?o("div",{staticClass:"col-12"},t._l(this.$store.state.production.woodsSelected,(function(e){return o("div",{key:e.id},[o("card-item-in-from",{staticClass:"q-ma-xs",attrs:{removeItem:t.removeItem,item:e}})],1)})),0):t._e()]),o("div",{staticClass:"row justify-center q-mt-md"},[o("div",{staticClass:"col-8 justify-center"},[o("q-btn",{attrs:{color:"primary full-width q-mt-md",glossy:"",label:"Tạo pallet"},on:{click:t.createPallet}})],1)])],1)]):o("div",{staticClass:"row justify-center"},[o("div",{staticClass:"col-6 justify-center"},[o("q-inner-loading",{attrs:{showing:!this.$store.state.production.loadXepSayDone}},[o("q-spinner-gears",{attrs:{size:"150px",color:"primary"}})],1)],1)]),o("dialog-success",{attrs:{show:t.showSuccess,palletCode:t.palletCode,closeDialog:t.closeDialog}})],1)},a=[],i=(o("a481"),o("6b54"),o("7514"),o("20d6"),o("ac6a"),o("cadf"),o("5df3"),o("7f7f"),o("551c"),o("06db"),o("f79b"),o("dd38")),l=o("075b"),n=o("4778"),c=o("c0af"),r={components:{"app-bar":i["a"],"info-factoryfsc":n["a"],"card-item-in-from":l["a"],"dialog-success":c["a"]},data:function(){return{items:[],item:null,palletTypes:[],palletTypeSelect:null,woodsLotNo:"",showSuccess:!1,palletCode:"",materials:[],materialSelected:null,woodType:null,woodTypes:[]}},beforeDestroy:function(){this.$store.dispatch("production/ACTION_LOAD_XEP_SAY_DONE",!1)},mounted:function(){var t=this,e=JSON.parse(localStorage.getItem("malogo"));null!==e&&void 0!==e&&""!==e&&(this.woodsLotNo=e);var o=JSON.parse(localStorage.getItem("typexs"));this.palletTypeSelect=o;var s=new Promise((function(e,o){t.$store.state.production.typePalletInOutdoors.length>0?(t.$store.state.production.typePalletInOutdoors.forEach((function(e){var o={label:e.name,value:e.id};t.palletTypes.push(o)})),e(!0)):t.$store.dispatch("production/ACTION_GET_PACKAGE_TYPE").then((function(o){t.$store.state.production.typePalletInOutdoors.forEach((function(e){var o={label:e.name,value:e.id};t.palletTypes.push(o)})),e(!0)})).catch((function(t){o(!1)}))})),a=new Promise((function(e,o){t.$store.dispatch("production/ACTION_LOAD_WOOD_TYPES","wood-processing").then((function(o){o.data.forEach((function(e){var o={label:e.name,value:e.id};t.woodTypes.push(o)})),t.woodTypes.length>0&&(t.woodType=t.woodTypes[0]),e(!0)}))})),i=new Promise((function(e,o){var s=t.$store.getters["base/myFactoryInfor"].id,a={factoryId:s};t.$store.dispatch("production/ACTION_FETCH_ITEMS",a).then((function(t){e(!0)})).catch((function(t){console.log(" Load Item Fail !",t),o(!1)}))}));Promise.all([s,i,a]).then((function(e){console.log(e),t.$store.dispatch("production/ACTION_LOAD_XEP_SAY_DONE",!0)})).catch((function(e){console.log(e),t.$q.notify({message:"Đã xảy ra lỗi !",position:"center"})}))},methods:{changeType:function(t){this.$store.dispatch("production/ACTION_SELECT_TYPE_IN_OUT",t),localStorage.setItem("typexs",JSON.stringify(t))},selectItemChoosed:function(t){},choose:function(){var t=this;if(-1===this.$store.state.production.woodsSelected.findIndex((function(e){return e.id===t.materialSelected.value}))){var e=this.$store.state.production.items.find((function(e){return e.id===t.materialSelected.value}));this.$store.dispatch("production/ACTION_CHOOSE_WOODS",e).then((function(){t.materialSelected=null}))}else this.$q.notify({message:"Qui cách này đã chọn trước đó rồi ",color:"red"})},saveLoWoods:function(t){localStorage.setItem("malogo",JSON.stringify(t))},navigationWoods:function(){this.$router.push("/production-woods-items")},searchMaterial:function(t,e){var o=this,s=[];this.$store.state.production.items.forEach((function(t){if(100002===t.type.id||100001===t.type.id){var e={label:t.height+" "+t.width+" "+t.length+" - "+t.name,value:t.id};s.push(e)}})),e(""!==t?function(){var e=t.toLowerCase();o.materials=s.filter((function(t){var o=t.label;if(o.toString().indexOf(e)>-1)return t}))}:function(){o.materials=s})},createPallet:function(){var t=this;if(this.$store.state.production.woodsSelected.length>0&&this.palletTypeSelect.value>0){for(var e=[],o=[],s=!0,a=0;a<this.$store.state.production.woodsSelected.length;a++){var i=this.$store.state.production.woodsSelected[a];if(void 0===i.qty){s=!1;break}if(parseFloat(i.qty)<=0||""===i.qty.toString().trim()){s=!1;break}e.push(i.id),o.push(i.qty)}if(s){var l={sourceId:this.$store.getters["base/mySources"][0].id,destinationId:this.$store.getters["base/myDestinations"][0].id,itemId:e.toString().replace("[").replace("]"),quantity:o.toString().replace("[").replace("]"),typeId:this.palletTypeSelect.value,parcel:this.woodsLotNo,woodTypeId:this.woodType?this.woodType.value:null};this.$store.dispatch("production/ACTION_CREATE_PALLET",l).then((function(e){if(!0===e.meta.success){t.$store.dispatch("production/ACTION_REMOVE_ALL_WOOD"),t.palletCode=e.data[0].code,t.showSuccess=!0;var o="Đã nhận được pallet số "+e.data[0].code,s="Từ công đoạn  "+t.$store.getters["base/mySources"][0].name,a="/#/production-dashboard?code="+e.data[0].code,i=t.$store.getters["base/myDestinations"][0].id.toString()+"-RECIVED-PALLET";t.$sendFcm(o,s,a,i,{palletCode:t.palletCode}).then((function(t){console.log(t)})),t.$sendFcm(),t.$q.notify({message:"Tạo pallet thành công !",color:"green"});var l={eventName:"Tạo Pallet Xếp Sấy",timeStamp:(new Date).toISOString(),status:1,palletCode:t.palletCode,palletType:t.palletTypeSelect.label};t.$eventLog(l)}}))}else this.$q.notify({message:"Dữ liệu không chính xác !",color:"red"})}else this.$q.notify({message:"Dữ liệu không chính xác !",color:"red"})},removeItem:function(t){this.$store.dispatch("production/ACTION_REMOVE_WOOD",t)},closeDialog:function(){this.showSuccess=!1}}},d=r,p=o("2877"),u=o("9989"),h=o("ddd8"),f=o("27f9"),m=o("9c40"),y=o("74f7"),g=o("cf57"),v=o("eebe"),S=o.n(v),T=Object(p["a"])(d,s,a,!1,null,null,null);e["default"]=T.exports;S()(T,"components",{QPage:u["a"],QSelect:h["a"],QInput:f["a"],QBtn:m["a"],QInnerLoading:y["a"],QSpinnerGears:g["a"]})}}]);