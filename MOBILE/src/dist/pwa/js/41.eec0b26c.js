(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[41],{"942b":function(t,a,e){},"97e9":function(t,a,e){"use strict";var n=e("942b"),o=e.n(n);o.a},b861:function(t,a,e){"use strict";e.r(a);var n=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{staticClass:"q-pa-md"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("q-card",{staticClass:"q-my-lg"},[e("q-card-section",[e("div",{staticClass:"box-ribbon-wrapper"},[e("q-ribbon",{staticStyle:{"margin-left":"-17px"},attrs:{decoration:"point-in","background-color":"secondary",inline:""}},[t._v("Tùy chỉnh đơn giá")])],1)]),e("q-card-section",[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("p",{staticClass:"woodText"},[t._v("Biên bản "),e("b",[t._v(" "+t._s(t.payInfo.info.YEAR)+"."+t._s(t.payInfo.info.NUMBER_OF_MONTH)+"/"+t._s(t.payInfo.info.MONTH)+t._s(t.payInfo.info.WH_CODE))])]),e("p",{staticClass:"woodText"},[t._v("Tổng khối lượng nhập kho : "),e("b",[t._v(t._s(t.payInfo.total.totalWHVolumn))]),t._v(" m³")]),e("p",{staticClass:"woodText"},[t._v("Tổng thành tiền : "),e("b",[t._v(t._s(t.tAmount))]),t._v(" VNĐ")]),e("q-checkbox",{staticClass:"woodText",attrs:{"left-label":"",label:"Thuế 10%"},on:{input:t.changeTax},model:{value:t.isTax,callback:function(a){t.isTax=a},expression:"isTax"}}),e("p",{directives:[{name:"show",rawName:"v-show",value:t.isTax,expression:"isTax"}],staticClass:"woodText"},[t._v("Thuế 10% : "+t._s(t.taxVAT))]),e("p",{staticClass:"woodText"},[t._v("Tổng thanh toán : "),e("b",[t._v(t._s(t.totalPay)+" VNĐ")])]),e("p",{staticClass:"woodText"},[t._v("Đơn giá trung bình của biên bản : "),e("b",[t._v(t._s(this.AVGAmount))])])],1)])]),e("q-card-section",{attrs:{align:"right"}},[e("q-btn",{attrs:{color:"primary",icon:"check",label:"Lưu lại"},on:{click:function(a){t.showConfirm=!0}}})],1)],1)],1)]),e("div",{staticClass:"row q-mt-md"},[e("div",{staticClass:"col-12"},[e("DxDataGrid",{attrs:{"data-source":t.sortArr,"show-borders":!0,"key-expr":"CID","word-wrap-enable":!0,"allow-column-reordering":!0,"on-content-ready":t.onContent,"repaint-changes-only":!0},on:{editorPreparing:t.onEditorPreparing}},[e("DxEditing",{attrs:{"allow-updating":!0,mode:"row"}}),e("DxColumn",{attrs:{"group-index":0,"data-field":"PID"}}),e("DxColumn",{attrs:{"data-field":"INPUT_NAME",caption:"Phân Loại nhập"}},[e("DxRequiredRule")],1),e("DxColumn",{attrs:{"data-field":"ITEM_ID",caption:"Sản phẩm","calculate-cell-value":t.calculateItem}}),e("DxColumn",{attrs:{caption:"Số thanh giao","data-type":"number",format:"fixedPoint","data-field":"TOTAL_QTY"}}),e("DxColumn",{attrs:{caption:"Tỷ lệ % Nghiệm Thu",formar:"#0.00%","data-type":"number","data-field":"INS_RATE","calculate-cell-value":t.calculateInsRate}}),e("DxColumn",{attrs:{caption:"Tỷ lệ % thanh toán","data-type":"number",format:"#0.00%","data-field":"PAY_RATE","calculate-cell-value":t.calculatePayRate}}),e("DxColumn",{attrs:{caption:"Thể tích theo QC TT (m³)","data-type":"number",format:"#0.0000","data-field":"QCTTVolum"}}),e("DxColumn",{attrs:{caption:"Thể tích theo QC (m³)","data-type":"number",format:"#0.0000","data-field":"QC_VOLUMN"}}),e("DxColumn",{attrs:{caption:"Thể tích theo kho (m³)","data-type":"number",format:"#0.0000","data-field":"WH_VOLUMN"}}),e("DxColumn",{attrs:{"data-field":"NOTE",caption:"Note"}}),e("DxColumn",{attrs:{"data-field":"COM_PRICE",caption:"Đơn giá","data-type":"number",format:"fixedPoint"}},[e("DxRequiredRule")],1),e("DxColumn",{attrs:{"data-field":"ITYPE_PRICE",caption:"Đơn giá Loại","data-type":"number",format:"fixedPoint"}},[e("DxRequiredRule")],1),e("DxColumn",{attrs:{"data-field":"SaleAmount",caption:"Thành Tiền  (VNĐ)","data-type":"number",format:"fixedPoint","calculate-cell-value":t.calculateAmount,width:"180"}}),e("DxSummary",[e("DxTotalItem",{attrs:{column:"WH_VOLUMN","summary-type":"sum","value-format":"000.0000#","display-format":"{0}"}}),e("DxTotalItem",{attrs:{column:"SaleAmount","summary-type":"sum","value-format":"fixedPoint","display-format":"{0}",width:"600"}}),e("DxGroupItem",{attrs:{"show-in-group-footer":!0,column:"SaleAmount","summary-type":"sum","value-format":"fixedPoint","display-format":"{0}"}}),e("DxGroupItem",{attrs:{"show-in-group-footer":!0,column:"WH_VOLUMN","summary-type":"sum","value-format":"00.0000#","display-format":"{0}"}})],1)],1)],1)]),e("q-dialog",{attrs:{persistent:""},model:{value:t.showConfirm,callback:function(a){t.showConfirm=a},expression:"showConfirm"}},[e("q-card",{staticStyle:{"min-width":"320px"}},[e("q-card-section",{staticClass:"row items-center"},[e("span",{staticClass:"q-ml-sm"},[t._v("Bạn đã chắc chắn !")])]),e("q-card-actions",{attrs:{align:"right"}},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy",color:"primary"}}),e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đồng Ý",color:"primary"},on:{click:t.savePrice}})],1)],1)],1)],1)},o=[],r=(e("7f7f"),e("7514"),e("a34a")),i=e.n(r),s=(e("20d6"),e("96cf"),e("c973")),u=e.n(s),c=(e("551c"),e("ac6a"),e("cadf"),e("06db"),e("5df3"),e("fa7d")),l=e("d30a"),d={components:{DxDataGrid:l["DxDataGrid"],DxColumn:l["DxColumn"],DxEditing:l["DxEditing"],DxLookup:l["DxLookup"],DxRequiredRule:l["DxRequiredRule"],DxSummary:l["DxSummary"],DxTotalItem:l["DxTotalItem"],DxGroupItem:l["DxGroupItem"]},data:function(){return{isTax:!1,receipt:{},payInfo:{},sortArr:[],dataSource:[],items:[],iTypes:[],dTypes:[],wTypes:[],totalAmount:0,showConfirm:!1,totalWHVolumn:0,totalQCVolumn:0,insRate:0,AVGAmount:0,payRate:0,taxVAT:0,tAmount:0,totalPay:0,tAmountValue:0}},watch:{totalPay:function(t){this.AVGAmount=Object(c["d"])(Object(c["k"])(this.tAmountValue/this.payInfo.total.totalWHVolumn,0))}},created:function(){var t=this,a=(this.$route.params.id,this.$store.state.wood.payCalInfo.detail);this.payInfo=this.$store.state.wood.payCalInfo,this.sortArr=a,Promise.all([this.loadItems()]).then((function(){t.totalPay=t.tAmount}))},computed:{format:function(t){return Object(c["d"])(t)}},methods:{changeTax:function(t){if(t){var a=.1*this.tAmountValue;this.taxVAT=Object(c["d"])(Object(c["k"])(a,0)),this.totalPay=Object(c["d"])(Object(c["k"])(a,0)+this.tAmountValue)}else this.taxVAT=0,this.totalPay=this.tAmount},onContent:function(t){var a=0;return this.isTax?(a=Object(c["k"])(t.component.getTotalSummaryValue("SaleAmount"),0),this.taxVAT=Object(c["d"])(Object(c["k"])(.1*a,0)),this.totalPay=Object(c["d"])(Object(c["k"])(a+0,0))):this.totalPay=Object(c["d"])(a),this.tAmountValue=Object(c["k"])(t.component.getTotalSummaryValue("SaleAmount"),0),this.tAmount=Object(c["d"])(this.tAmountValue),this.tAmount},savePrice:function(){var t=this;return u()(i.a.mark((function a(){var e,n,o,r,s,u;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:for(e=t.sortArr.filter((function(t){return"INP"===t.ICODE})),e.forEach((function(a){var e=t.sortArr.findIndex((function(t){return t.CID===a.CID})),n=Object(c["k"])(a.QCTTVolum*a.ITYPE_PRICE,0),o=n,r=t.sortArr.filter((function(t){return"INS"===t.ICODE&&t.PARENTID===a.CID}));t.sortArr[e].Amount=n,r.forEach((function(a){var e=t.sortArr.findIndex((function(t){return t.CID===a.CID})),n=Object(c["k"])(a.ITYPE_PRICE*a.QCTTVolum,0);t.sortArr[e].Amount=n,o+=n}));var i=Object(c["k"])(o/a.WH_VOLUMN,0);t.sortArr[e].avgAmount=i,t.totalAmount+=o,t.totalWHVolumn+=a.WH_VOLUMN})),t.AVGAmount=Object(c["k"])(t.totalAmount/t.totalWHVolumn,0),t.insRate=Object(c["k"])(t.payInfo.total.insRate,4),n="",o="",r=0;r<t.sortArr.length;r++)"INP"===t.sortArr[r].ICODE&&(n+=t.sortArr[r].ITEM_ID+",",o+=t.sortArr[r].TOTAL_QTY+",");return s={id:t.$route.params.id,data:{arr:t.sortArr,total:{totalAmount:t.totalAmount,totalWHVolumn:t.totalWHVolumn,totalQCVolumn:t.totalQCVolumn,AVGAmount:t.AVGAmount,insRate:t.insRate,payRate:t.payRate,taxVAT:t.isTax?Object(c["k"])(.1*t.tAmountValue,0):0},manual:1},pallet:{sourceId:t.$store.getters["base/mySources"][0].id,destinationId:t.$store.getters["base/myDestinations"][0].id,itemId:n.slice(0,n.length-1),quantity:o.slice(0,o.length-1)}},a.next=10,t.$store.dispatch("wood/COMPLETED_PAYMENT",s);case 10:u=a.sent,!0===u.meta.success&&(t.$q.notify({message:"Thành công !",color:"green"}),t.$router.push({name:"view-payment-completed",params:{id:t.$route.params.id}}));case 12:case"end":return a.stop()}}),a)})))()},calculateItem:function(t){var a=this.items.find((function(a){return a.value===t.ITEM_ID}));return a?a.label:"..."},calculateAVGAmount:function(t){},onEditorPreparing:function(t){"SaleAmount"===t.dataField&&(t.editorOptions.disabled=!0)},calculateNote:function(t){var a=this.dTypes.find((function(a){return a.value.trim()===t.DTYPE.trim()}));return t.WOOD_TYPE+" "+a.label},calculateAmount:function(t){return t.ITYPE_PRICE*t.QCTTVolum},calculateWHVOLUMN:function(t){return"INPUT"===t.ITYPE?t.WH_VOLUMN:0},calculateQCVOLUMN:function(t){return"INPUT"===t.ITYPE?t.QC_VOLUMN:0},calculateQCVOLUMNTT:function(t){if("INPUT"===t.ITYPE)return Object(c["k"])(t.PAY_RATE*t.ITEM_VOLUMN*t.PCS_PER_PACKAGE*t.PACKAGE_QUANTITY,4);var a=this.sortArr.findIndex((function(a){return a.CID===t.PARENTID})),e=this.sortArr[a];return Object(c["k"])(Object(c["k"])(1-e.PAY_RATE,2)*t.ITEM_VOLUMN*e.TOTAL_QTY,4)},calculateTotalQty:function(t){return t.PACKAGE_QUANTITY*t.PCS_PER_PACKAGE},calculatePayRate:function(t){if("INPUT"===t.ITYPE)return t.PAY_RATE;var a=this.sortArr.findIndex((function(a){return a.CID===t.PARENTID})),e=Object(c["k"])(1-this.sortArr[a].PAY_RATE,2);return e},calculateInsRate:function(t){return"INPUT"===t.ITYPE?100*t.INS_RATE:t.INS_RATE.toFixed(0)},loadReceiptInfo:function(t){var a=this;return u()(i.a.mark((function e(){var n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$store.dispatch("wood/GET_DETAIL_RECEIPT",t);case 2:n=e.sent,a.receipt=n.data[0];case 4:case"end":return e.stop()}}),e)})))()},loadPay:function(t){var a=this;return u()(i.a.mark((function e(){var n;return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$store.dispatch("wood/GET_PAYMENT_DETAIL_BY_RECEIPT_ID",t);case 2:n=e.sent,a.sortArr=Object(c["q"])(n.data),a.payInfo=n.data;case 5:case"end":return e.stop()}}),e)})))()},loadDType:function(){var t=this;return new Promise(function(){var a=u()(i.a.mark((function a(e,n){var o;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$store.dispatch("wood/GET_DTYPE",t.$store.state.base.moduleSelected.id);case 2:o=a.sent,o.data.forEach((function(a){var e={label:a.NAME,value:a.CODE};t.dTypes.push(e)})),t.dTypes.length>0&&(t.dType=t.dTypes[0]),e(!0);case 6:case"end":return a.stop()}}),a)})));return function(t,e){return a.apply(this,arguments)}}())},loadwType:function(){var t=this;return new Promise(function(){var a=u()(i.a.mark((function a(e,n){var o;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$store.dispatch("wood/GET_WOOD_TYPE");case 2:o=a.sent,o.data.length>0&&o.data.forEach((function(a){var e={value:a.ID,label:a.NAME};t.wTypes.push(e)})),e(!0);case 5:case"end":return a.stop()}}),a)})));return function(t,e){return a.apply(this,arguments)}}())},loadInputType:function(){var t=this;return new Promise(function(){var a=u()(i.a.mark((function a(e,n){var o,r;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o={moduleId:t.$store.state.base.moduleSelected.id},a.next=3,t.$store.dispatch("wood/GET_INPUT_TYPE",o);case 3:r=a.sent,r.data.forEach((function(a){var e={label:a.NAME,value:a.ID};t.iTypes.push(e)})),t.iTypes.length>0&&(t.iType=t.iTypes[0]),e(!0);case 7:case"end":return a.stop()}}),a)})));return function(t,e){return a.apply(this,arguments)}}())},loadItems:function(){var t=this;return new Promise(function(){var a=u()(i.a.mark((function a(e,n){var o,r;return i.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o=t.$store.state.base.moduleSelected.id,a.next=3,t.$store.dispatch("wood/GET_ITEM_BY_MODULE_ID",o);case 3:r=a.sent,r.data.length>0&&(r.data.forEach((function(a){var e={value:a.id,label:a.height+"*"+a.width+"*"+a.length+" ("+a.name+")"};t.items.push(e)})),t.itemsDuplicate=t.items),e(r);case 6:case"end":return a.stop()}}),a)})));return function(t,e){return a.apply(this,arguments)}}())}}},m=d,p=(e("97e9"),e("2877")),f=e("9989"),h=e("f09f"),T=e("a370"),A=e("8f8e"),x=e("9c40"),I=e("24e8"),v=e("4b7e"),y=e("7f67"),C=e("eebe"),b=e.n(C),E=Object(p["a"])(m,n,o,!1,null,null,null);a["default"]=E.exports;b()(E,"components",{QPage:f["a"],QCard:h["a"],QCardSection:T["a"],QCheckbox:A["a"],QBtn:x["a"],QDialog:I["a"],QCardActions:v["a"]}),b()(E,"directives",{ClosePopup:y["a"]})}}]);