(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[105],{c09f:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("q-page",{staticClass:"q-pa-md"},[s("div",{staticClass:"row justify-center"},[s("div",{staticClass:"col-12 col-sm-6 q-ma-sm"},[s("q-card",{staticClass:"q-pa-md"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col-12"},[s("p",{staticClass:"prodTextTitle"},[t._v("Xuất kho")])])]),s("div",{staticClass:"row"},[s("div",{staticClass:"col-8 q-pa-xs"},[s("q-input",{attrs:{clearable:"",outlined:"",label:"Số pallet"},on:{clear:t.clearCode},model:{value:t.palletCode,callback:function(e){t.palletCode=t._n(e)},expression:"palletCode"}})],1),t.showButtonCheck?s("div",{staticClass:"col-4 q-pa-xs"},[s("q-btn",{staticClass:"full-width",staticStyle:{height:"100%"},attrs:{label:"Kiểm tra",stack:"",glossy:"",color:"blue"},on:{click:t.check}})],1):s("div",{staticClass:"col-4 q-pa-sm justify-center"},[s("q-spinner-ios",{attrs:{color:"primary",size:"4em"}})],1)])])],1)]),t.showFakeKeyboard?s("div",{staticClass:"row justify-center q-mt-md"},[s("div",{staticClass:"col-12 col-sm-6"},[s("div",{staticClass:"row justify-center",staticStyle:{"text-align":"center"}},t._l(12,(function(e){return s("div",{key:e,staticClass:"col-4 q-ms-sm"},[e<10?s("div",{staticClass:"fakeKeyboard",on:{click:function(s){return t.inputCode(e)}}},[t._v(t._s(e))]):t._e(),11===e?s("div",{staticClass:"fakeKeyboard",on:{click:function(e){return t.inputCode(0)}}},[t._v("0")]):t._e(),10===e?s("div",{staticClass:"fakeKeyboard",staticStyle:{"background-color":"#f5a278"},on:{click:t.backspace}},[s("q-icon",{staticStyle:{"font-size":"32px"},attrs:{name:"backspace"}})],1):t._e(),12===e?s("div",{staticClass:"fakeKeyboard",staticStyle:{"background-color":"red"},on:{click:t.clearInput}},[t._v("Xóa")]):t._e()])})),0)])]):t._e(),t.showPallet?s("div",{staticClass:"row justify-center"},[s("div",{staticClass:"col-12 q-ma-sm"},[s("table-coc")],1),s("div",{staticClass:"col-12 col-sm-6 q-ma-sm"},[s("q-card",[s("q-card-section",[s("p",{staticClass:"prodTextTitle"},[t._v(t._s(t.pallet.item[0].name))]),s("p",[t._v("QC: "+t._s(t.pallet.item[0].height+" "+t.pallet.item[0].width+" "+t.pallet.item[0].length)+" x "+t._s(t.pallet.inventory))]),s("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{readonly:!t.allowSelectDestination,behavior:"dialog",options:t.destinations,label:"Công đoạn tiếp theo : :"},model:{value:t.destination,callback:function(e){t.destination=e},expression:"destination"}})],1),s("q-separator",{attrs:{inset:""}}),s("q-card-section",[s("div",{staticClass:"row"},[s("div",{staticClass:"col-6 q-pa-md"},[s("q-input",{attrs:{outlined:"",label:"SL đạt"},model:{value:t.passQty,callback:function(e){t.passQty=e},expression:"passQty"}})],1),s("div",{staticClass:"col-6 q-pa-md"},[s("q-input",{attrs:{outlined:"",readonly:"",label:"SL Lỗi"},model:{value:t.failQty,callback:function(e){t.failQty=e},expression:"failQty"}})],1)]),s("div",{directives:[{name:"show",rawName:"v-show",value:t.showButtonStockOut,expression:"showButtonStockOut"}],staticClass:"row"},[s("q-btn",{staticClass:"glossy full-width",attrs:{color:"secondary",label:"Xuất Pallet"},on:{click:t.validate}})],1)])],1)],1)]):s("div",{staticClass:"row q-pa-sm justify-center"},[t.showButtonCheck?t._e():s("div",{staticClass:"col-12 justify-centerquas",staticStyle:{"text-align":"center","min-height":"300px"}},[s("q-spinner-ios",{attrs:{color:"primary",size:"4em"}})],1)]),s("q-dialog",{attrs:{persistent:""},model:{value:t.showDialog,callback:function(e){t.showDialog=e},expression:"showDialog"}},[s("q-card",{staticStyle:{"min-width":"300px"}},[s("q-card-section",{staticClass:"row items-center"},[s("span",{staticClass:"q-ml-sm prodTextTitle"},[t._v("Bạn đã chắc chắn ? !")])]),s("q-card-actions",{attrs:{align:"right"}},[s("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy",color:"primary"}}),s("q-btn",{attrs:{flat:"",label:"Đồng Ý",color:"primary"},on:{click:t.confirm}})],1)],1)],1)],1)},o=[],i=(s("6b54"),s("06db"),s("7f7f"),s("20d6"),s("7514"),s("889c")),l={components:{"table-coc":i["a"]},data:function(){return{palletCode:"",showButtonCheck:!0,pallet:{},showFakeKeyboard:!0,destinations:[],destination:null,showPallet:!1,mySources:[],passQty:"",failQty:"",showButtonRecive:!1,toStep:{},showButtonStockOut:!1,showDialog:!1,myStep:null,allowSelectDestination:!1}},created:function(){var t=this.$route.query.code;if(t&&8===t.length){this.palletCode=t;var e={token:this.$store.state.production.userInfo.token,palletCode:t.trim()};this.loaData(e)}},watch:{passQty:function(t){var e=parseFloat(this.$store.state.production.palletSelected.inventory);""===t.trim()?this.failQty="0":t>e?(this.$q.notify({message:"Vượt quá số lượng !",color:"red"}),this.failQty="0"):this.failQty=e-parseFloat(t)}},methods:{loaData:function(t){var e=this;this.allowSelectDestination=!1,this.showPallet=!1,this.destinations=[],this.destination=null,this.$store.dispatch("production/ACTION_GET_DETAIL_PALLET",t).then((function(t){if(!0===t.meta.success){e.pallet=t.data;var s=t.data.step.slice(-1).pop(),a=s.package.find((function(t){return t.destinationId===s.stepNextId}));if(e.mySources=e.$store.getters["base/mySources"],e.myStep=e.mySources.find((function(t){return t.id===s.stepNextId})),-1!==e.mySources.findIndex((function(t){return t.id===s.stepNextId})))if(a.verifyBy){e.showButtonStockOut=!0;var o={itemId:e.pallet.item[0].id,token:e.$store.state.production.userInfo.token};e.$store.dispatch("production/ACTION_GET_DESTINATION_BY_ITEM",o).then((function(t){if(t.data.length>0){var a=t.data.findIndex((function(t){return t.id===s.stepNextId})),o={label:t.data[a+1].name,value:t.data[a+1].id};e.destinations.push(o),e.destination=o}e.$store.getters["base/myDestinations"].length>0&&e.$store.getters["base/myDestinations"].forEach((function(t){if(-1===e.destinations.findIndex((function(e){return e.value===t.id}))){var s={label:t.name,value:t.id};e.destinations.push(s)}})),e.destinations.length>1&&(e.allowSelectDestination=!0,e.$q.notify({message:"Hãy chú ý nơi xuất pallet !",color:"orange"})),0===e.destinations.length&&(e.$q.notify({message:"Không tìm thấy công đoạn tiếp theo ! Vui lòng kiểm tra lại",color:"red",position:"center"}),e.showPallet=!1),1===e.destinations.length&&(e.destination=e.destinations[0])}))}else e.$q.notify({message:"Pallet này chưa được nhận !",color:"warnning"}),setTimeout((function(){e.$router.push("/production-dashboard?code="+e.pallet.code+"&path=production-stockout-pallet?code="+e.pallet.code)}),1e3);else e.showButtonStockOut=!1,e.$q.notify({message:"Bạn không có quyền xuất pallet này !",color:"red"})}else e.$q.notify({message:t.meta.messages.message,color:"red"});e.showButtonCheck=!0,e.showPallet=!0})).catch((function(t){console.log(t),e.$q.notify({message:"Không tìm thấy pallet",color:"red"}),e.showPallet=!1,e.showButtonCheck=!0,e.palletCode=""}))},validate:function(){null!==this.destination&&this.passQty>0?this.showDialog=!0:(this.$q.notify({message:"Dữ liệu không chính xác !",color:"red",position:"center"}),this.showDialog=!1)},checkPalletRecived:function(){},confirm:function(){var t=this;this.showDialog=!1,this.showPallet=!1,this.showButtonCheck=!1;var e=this.pallet.inventory;if(parseFloat(this.passQty)>0&&parseFloat(this.passQty)<=parseFloat(e)){var s={data:{sourceId:this.myStep.id,destinationId:this.destination.value,notPass:this.failQty,pass:this.passQty,token:this.$store.state.production.userInfo.token},palletCode:this.pallet.code};this.$store.dispatch("production/ACTION_STEP_PALLET",s).then((function(e){if(!0===e.meta.success){t.$q.notify({message:"Xác nhận thành công !",color:"green"});var a=t.destination.label,o=t.destination.value.toString()+"-RECIVED-PALLET",i="Đã nhận được pallet số "+s.palletCode,l="Nhận được pallet từ công đoạn "+t.myStep.name+" chuyển đến công đoạn "+a,n="/#/production-dashboard?code="+s.palletCode;if(t.$sendFcm(i,l,n,o,{palletCode:s.palletCode}).then((function(t){console.log(t)})),t.showPallet=!1,t.pallet=null,t.destinations=[],t.destination=null,t.palletCode="",t.showButtonCheck=!0,parseFloat(t.failQty)>0){var c=t.pallet.item[0].height+" "+t.pallet.item[0].width+" "+t.pallet.item[0].length,r=t.$store.getters["base/myFactoryInfor"].id,d=r+"-QC",h="Phát sinh lỗi tại công đoạn "+t.myStep.name,p="Nhận được Qui cách : "+c+"   Số lượng : "+t.failQty,u="/#/production-qc-inspection";t.$sendFcm(h,p,u,d)}}else t.$q.notify({message:e.meta.messages.message||e.meta.messages.originalError.info.message,color:"red"}),t.showButtonCheck=!0}))}else this.$q.notify({message:"Dữ liệu không chính xác , Vui lòng kiểm tra lại !",color:"red"}),this.showPallet=!0,this.showButtonCheck=!0},clearCode:function(t){this.showPallet=!1,this.pallet=null,this.showFakeKeyboard=!0},clearInput:function(){this.palletCode=""},backspace:function(){this.palletCode.length>0&&(this.palletCode=this.palletCode.toString().slice(0,-1))},inputCode:function(t){null===this.palletCode&&(this.palletCode=""),this.palletCode+=t.toString()},check:function(){if(8===this.palletCode.toString().length){this.showFakeKeyboard=!1,this.showButtonCheck=!1;var t={token:this.$store.state.production.userInfo.token,palletCode:this.palletCode};this.loaData(t)}else this.$q.notify({message:"Số pallet không chính xác !",color:"red"})}}},n=l,c=s("2877"),r=s("9989"),d=s("f09f"),h=s("27f9"),p=s("9c40"),u=s("d9b2"),f=s("0016"),m=s("a370"),y=s("ddd8"),g=s("eb85"),C=s("24e8"),v=s("4b7e"),w=s("7f67"),k=s("eebe"),b=s.n(k),q=Object(c["a"])(n,a,o,!1,null,null,null);e["default"]=q.exports;b()(q,"components",{QPage:r["a"],QCard:d["a"],QInput:h["a"],QBtn:p["a"],QSpinnerIos:u["a"],QIcon:f["a"],QCardSection:m["a"],QSelect:y["a"],QSeparator:g["a"],QDialog:C["a"],QCardActions:v["a"]}),b()(q,"directives",{ClosePopup:w["a"]})}}]);