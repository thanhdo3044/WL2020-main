(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[139],{c53d:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{staticClass:"q-pa-md"},[!0===this.$store.state.production.loadItemsDone?i("div",[i("app-bar",[e._v("Xuất Kho")]),i("div",{staticClass:"row justify-center"},[i("div",{staticClass:"col-12 col-md-6 q-ma-md"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{behavior:"dialog",options:e.receipts,label:"Số phiếu"},on:{input:e.loadItemInReceipt},model:{value:e.receipt,callback:function(t){e.receipt=t},expression:"receipt"}})],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{behavior:"dialog",options:e.sources,add:e.changeSource,label:"Kho :"},model:{value:e.sourceSelect,callback:function(t){e.sourceSelect=t},expression:"sourceSelect"}})],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showSelectDestination,expression:"showSelectDestination"}],staticClass:"row"},[i("div",{staticClass:"col-12"},[i("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{behavior:"dialog",options:e.destinations,label:"Nơi xuất đến :"},model:{value:e.destinationSelect,callback:function(t){e.destinationSelect=t},expression:"destinationSelect"}})],1)]),i("div",{staticClass:"row justify-center q-mt-md "},[null!==this.$store.state.production.itemChoosed&&void 0!==this.$store.state.production.itemChoosed&&void 0!==this.$store.state.production.itemChoosed.id?i("div",{staticClass:"col-12"},[i("card-item-in-from",{attrs:{removeItem:e.removeItem,item:this.$store.state.production.itemChoosed}})],1):e._e()]),"say"===e.typeScreen?i("div",{staticClass:"row justify-center"},[i("div",{staticClass:"col-9"},[i("q-select",{attrs:{options:e.items,"use-input":"","input-debounce":"0",behavior:"dialog",label:"Kích thước",outlined:""},on:{filter:e.searchItem},model:{value:e.item,callback:function(t){e.item=t},expression:"item"}})],1),i("div",{staticClass:"col-3"},[i("q-btn",{staticClass:" full-height q-ml-sm",attrs:{color:"cyan",label:"Chọn"},on:{click:e.chonQuiCach}})],1)]):e._e(),i("div",{staticClass:"row justify-center q-mt-md"},e._l(e.itemsSelected,(function(t,s){return i("div",{key:t.id,staticClass:"col-12 q-ma-sm"},[i("q-card",{staticClass:"my-card"},[i("q-card-section",[i("div",{staticClass:"row"},[i("div",{staticClass:"col-10"},[i("div",{staticClass:"text-h6"},[e._v("("+e._s(s+1)+") - "+e._s(t.name))])]),i("div",{staticClass:"col-1",attrs:{align:"right"}},[i("q-btn",{attrs:{color:"red",round:"",icon:"close"},on:{click:function(t){return e.removeMaterial(s)}}})],1)])]),i("q-card-section",["say"!==e.typeScreen?i("q-input",{attrs:{readonly:"",type:"text",label:"Số lượng nhập"},model:{value:t.inputQty,callback:function(i){e.$set(t,"inputQty",i)},expression:"item.inputQty"}}):e._e(),"say"!==e.typeScreen?i("br"):e._e(),i("q-input",{attrs:{outlined:"",type:"number",label:"Số lượng xuất"},model:{value:t.quantity,callback:function(i){e.$set(t,"quantity",e._n(i))},expression:"item.quantity"}})],1)],1)],1)})),0),e.validate?i("div",{staticClass:"row justify-center"},[i("div",{staticClass:"col-8 justify-center"},[i("q-btn",{attrs:{color:"primary full-width q-mt-md",glossy:"",label:"Xuất kho"},on:{click:function(t){e.showConfirm=!0}}})],1)]):e._e()])])],1):e._e(),i("dialog-success",{attrs:{show:e.showSuccess,palletCode:e.palletCode,closeDialog:e.closeDialog}}),i("q-dialog",{attrs:{persistent:""},model:{value:e.showConfirm,callback:function(t){e.showConfirm=t},expression:"showConfirm"}},[i("q-card",{staticStyle:{"min-width":"300px"}},[i("q-card-section",{staticClass:"row items-center"},[i("span",{staticClass:"prodTextTitle"},[e._v("Bạn đã chắc chắn ?")])]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy",color:"primary"}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đồng ý",color:"primary"},on:{click:e.createPallet}})],1)],1)],1)],1)},a=[],o=(i("6b54"),i("20d6"),i("ac6a"),i("cadf"),i("5df3"),i("7f7f"),i("a34a")),n=i.n(o),c=(i("96cf"),i("c973")),l=i.n(c),r=(i("551c"),i("06db"),i("28a5"),i("278c")),d=i.n(r),u=(i("f79b"),i("4778")),h=i("427f"),p=i("dd38"),m=i("9fb5"),f=i("075b"),v=i("c0af"),g=i("8e39"),S=(i("5918"),i("fa7d")),y=i("d30a"),C={components:{"app-bar":p["a"],"info-factoryfsc":u["a"],"card-itempallet":h["a"],"info-supplies":m["a"],"card-item-in-from":f["a"],"dialog-success":v["a"],"dialog-add-supplies":g["a"],DxDataGrid:y["DxDataGrid"],DxColumn:y["DxColumn"],DxEditing:y["DxEditing"],DxLookup:y["DxLookup"],DxRequiredRule:y["DxRequiredRule"],DxPopup:y["DxPopup"],DxPosition:y["DxPosition"],DxForm:y["DxForm"],DxItem:y["DxItem"]},beforeDestroy:function(){console.log("create pallet page destroy"),this.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET_INIT"),this.item=null,this.removeItem()},beforeMount:function(){this.removeItem()},data:function(){return{text:"",items:[],parcel:"",dialog:!1,item:null,loadDone:0,showLoadling:!0,sources:[],sourceSelect:null,destinations:[],destinationSelect:null,palletTypes:[],palletTypeSelect:null,materials:[],materialSelected:null,requireMaterialSelect:!1,validate:!1,showSuccess:!1,palletCode:"",showDialogAddSupplie:!1,showSelectItem:!1,showSelectDestination:!0,showConfirm:!1,prodOrder:null,prodOrders:[],woodType:null,woodTypes:[],lenhsx:"",requireSelectLSX:!0,itemsSelected:[],receipts:[],receipt:null,itemsInReceipt:[],typeScreen:""}},computed:{wathValidate:function(){return"".concat(this.sourceSelect,"|").concat(this.destinationSelect,"|").concat(this.itemsSelected,"|").concat(this.receipt)}},watch:{wathValidate:function(e,t){var i=e.split("|"),s=d()(i,4),a=s[0],o=s[1],n=s[2],c=s[3];this.validate="null"!==a&&"null"!==o&&"null"!==c&&"null"!==n}},created:function(){var e=this,t=new Promise(function(){var t=l()(n.a.mark((function t(i,s){var a,o,c;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=e.$store.getters["base/myWarehouses"][0].id,o={moduleCode:"vcn",warehouseId:a},!a){t.next=7;break}return t.next=5,e.$store.dispatch("wood/GET_RECEIPTS",o);case 5:c=t.sent,c.data.forEach((function(t){var i={label:t.NUMBER_OF_MONTH+"/"+t.MONTH+"."+t.YEAR,value:t.ID};e.receipts.push(i)}));case 7:i(!0);case 8:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}()),i=new Promise(function(){var t=l()(n.a.mark((function t(i,s){var a,o,c,l;return n.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=e.$route.query.type,e.typeScreen=a,o=100007,"say"===a&&(o=100007),c={factoryId:e.$store.getters["base/myFactoryInfor"].id,typeId:o},t.next=7,e.$store.dispatch("production/GET_ITEMS",c);case 7:l=t.sent,l.forEach((function(t){e.items.push({value:t.id,label:t.name})})),i(!0);case 10:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}());Promise.all([i,t]).then((function(t){e.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET");var i=e.$store.getters["base/mySources"],s=e.$store.getters["base/myDestinations"];i.forEach((function(t){var i={label:t.name,value:t.id};e.sources.push(i)})),e.sources.length>0&&(e.sourceSelect=e.sources[0]),s.forEach((function(t){e.destinations.push({value:t.id,label:t.name})})),e.destinations.length>0?e.destinationSelect=e.destinations[0]:e.$q.notify({message:"Tài khoản chưa được cấu hình !"})})).catch((function(e){console.log(e)}))},methods:{loadItemInReceipt:function(e){var t=this;return l()(n.a.mark((function i(){var s,a,o;return n.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(s=t.$route.query.type,"say"===s){i.next=8;break}return a=e.value,i.next=5,t.$store.dispatch("wood/GET_DETAIL_RECEIPT_BY_RECEIPT",a);case 5:o=i.sent,t.itemsInReceipt=o.data,t.itemsInReceipt.forEach((function(e){-1===t.itemsSelected.findIndex((function(t){return t.id===e.ID}))&&t.itemsSelected.push({id:e.ID,name:e.ITEM_NAME,quantity:"",inputQty:Object(S["d"])(e.PACKAGE_QUANTITY*e.PCS_PER_PACKAGE)})}));case 8:case"end":return i.stop()}}),i)})))()},initNewRow:function(){},insertedRow:function(){},onEditorPreparing:function(e){"id"!==e.dataField&&"height"!==e.dataField&&"length"!==e.dataField&&"width"!==e.dataField||(e.editorOptions.disabled=!0)},insertingRow:function(){},chonQuiCach:function(){this.item?(this.itemsSelected.push({name:this.item.label,id:this.item.value,quantity:0}),this.item=null):this.$q.notify({message:"Vui Lòng chọn sản phẩm trước !"})},blurMaLoGo:function(){localStorage.setItem("malogo",this.parcel)},changeSource:function(e){console.log(e)},toAddSupplies:function(){},closeDialog:function(){console.log("close dialog"),this.showSuccess=!1,this.itemsSelected=[]},chooseItem:function(){this.$router.push("/production-items")},removeItem:function(){this.$store.dispatch("production/ACTION_REMOVE_ITEM"),this.item=null},removeMaterial:function(e){console.log(this.itemsSelected),1===this.itemsSelected.length?this.itemsSelected=[]:this.itemsSelected.splice(0,e)},selectItemById:function(){this.$store.dispatch("production/ACTION_CHOOSE_ITEM",this.item)},selectMaterialById:function(){this.$store.dispatch("production/ACTION_SELECT_ONE_MATERIAL",this.materialSelected)},createPallet:function(){var e=this,t=!1,i="",s="";if(this.itemsSelected.length>0)for(var a=0;a<this.itemsSelected.length;a++){var o=this.itemsSelected[a];o.quantity&&o.quantity>0&&(t=!0,i+=o.id+",",s+=o.quantity+",")}if(this.receipt&&(this.validate=!0),t){var n=this.sourceSelect.value,c=this.destinationSelect.value,l=i.slice(0,-1),r=s.slice(0,-1),d={sourceId:n,destinationId:c,itemId:l,quantity:r,receiptId:this.receipt.value},u={eventName:"Tạo Pallet",timeStamp:(new Date).toISOString(),status:0,palletCode:"????????"};this.$store.dispatch("production/ACTION_CREATE_PALLET",d).then((function(t){if(!0===t.meta.success){e.palletCode=t.data[0].code,e.showSuccess=!0,e.removeItem(),e.removeMaterial();var i=e.destinationSelect.value.toString()+"-RECIVED-PALLET",s="Đã nhận được pallet số "+e.palletCode,a="Nhận được pallet từ công đoạn "+e.sourceSelect.label+" chuyển đến công đoạn "+e.destinationSelect.label,o="/#/production-dashboard?code="+e.palletCode;e.$sendFcm(s,a,o,i,{}).then((function(e){console.log("send fcm success",e)})).catch((function(e){console.log("send Error: "+e)})),e.$q.notify({message:"Tạo pallet thành công !",color:"green"}),u.status=1,u.palletCode=t.data[0].code}else u.status=0,e.$q.notify({message:t.meta.messages.message,color:"red"});e.$eventLog(u)}))}else this.$q.notify({message:"Thiếu thông tin, vui lòng kiểm tra lại",color:"red"})},closeConfirmAddSupplie:function(){this.showDialogAddSupplie=!1},searchItem:function(e,t){var i=this,s=[];this.$store.state.production.items.forEach((function(e){var t={label:e.name+" -> "+e.height+" "+e.width+" "+e.length,value:e.id};s.push(t)})),t(""!==e?function(){var t=e.toLowerCase();i.items=s.filter((function(e){var i=e.label;if(i.toString().indexOf(t)>-1)return e}))}:function(){i.items=s})},searchMaterial:function(e,t){var i=this,s=[];this.$store.state.production.woods.forEach((function(e){var t={label:e.name+" -> "+e.height+" "+e.width+" "+e.length,value:e.id};s.push(t)})),t(""!==e?function(){var t=e.toLowerCase();i.materials=s.filter((function(e){var i=e.label;if(i.toString().indexOf(t)>-1)return e}))}:function(){i.materials=s})}}},w=C,b=i("2877"),I=i("9989"),E=i("ddd8"),x=i("9c40"),q=i("f09f"),_=i("a370"),T=i("27f9"),D=i("24e8"),$=i("4b7e"),A=i("7f67"),R=i("eebe"),N=i.n(R),O=Object(b["a"])(w,s,a,!1,null,null,null);t["default"]=O.exports;N()(O,"components",{QPage:I["a"],QSelect:E["a"],QBtn:x["a"],QCard:q["a"],QCardSection:_["a"],QInput:T["a"],QDialog:D["a"],QCardActions:$["a"]}),N()(O,"directives",{ClosePopup:A["a"]})}}]);