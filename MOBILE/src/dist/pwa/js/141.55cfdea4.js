(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[141],{8709:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-sm"},[a("div",{staticClass:"row justify-center q-mt-sm"},[a("div",{staticClass:"col-6 prodTextTitle"},[e._v("Cập nhật bảng giá")]),a("div",{staticClass:"col-4",attrs:{align:"right"}},[a("q-btn",{directives:[{name:"show",rawName:"v-show",value:!e.showPreView,expression:"!showPreView"}],attrs:{disable:!(e.newPriceList.length>0),icon:"view",color:"primary",label:"Xem trước"},on:{click:e.preview}})],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.showPreView,expression:"!showPreView"}],staticClass:"row justify-center q-mt-sm"},[a("div",{staticClass:"col-12"},[a("q-card",[a("q-card-section",[a("q-select",{attrs:{options:e.regions,label:"Chọn bảng giá"},model:{value:e.region,callback:function(t){e.region=t},expression:"region"}})],1),a("q-card-section",[a("DxDataGrid",{attrs:{"data-source":e.newPriceList,"show-borders":!0,"key-expr":"ID"},on:{editorPreparing:e.onEditorPreparing,"init-new-row":e.initNewRow,"row-inserted":e.inserted,"row-inserting":e.inserting}},[a("DxColumn",{attrs:{"data-field":"ID"}}),a("DxEditing",{attrs:{"allow-adding":!0,"allow-deleting":!0,mode:"row"}}),a("DxColumn",{attrs:{"data-field":"WTYPE",caption:"Loại gỗ"}},[a("DxRequiredRule"),a("DxLookup",{attrs:{"data-source":e.wTypes,"display-expr":"label","value-expr":"value"}})],1),a("DxColumn",{attrs:{"data-field":"DTYPE",caption:"Trạng Thái gỗ"}},[a("DxRequiredRule"),a("DxLookup",{attrs:{"data-source":e.dTypes,"display-expr":"label","value-expr":"value"}})],1),a("DxColumn",{attrs:{"data-field":"ITYPE",caption:"Phân Loại nhập"}},[a("DxRequiredRule"),a("DxLookup",{attrs:{"data-source":e.iTypes,"display-expr":"label","value-expr":"value"}})],1),a("DxColumn",{attrs:{"data-field":"ItemID",caption:"Sản phẩm"}},[a("DxRequiredRule"),a("DxLookup",{attrs:{"data-source":e.items,"display-expr":"label","value-expr":"value"}})],1),a("DxColumn",{attrs:{"data-field":"OLD_PRICE",caption:"Đơn giá hiện tại","data-type":"number",format:"fixedPoint"}}),a("DxColumn",{attrs:{"data-field":"PRICE",caption:"Đơn giá mới","data-type":"number",format:"fixedPoint"}},[a("DxRequiredRule")],1)],1)],1)],1)],1)]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-12"},[a("q-card",{staticClass:"my-card"},[a("q-card-section",[a("div",{staticClass:"text-h6"},[e._v("Lý do cập nhật")])]),a("q-card-section",[a("q-input",{attrs:{outlined:"",type:"textarea"},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}})],1)],1)],1)]),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showPreView,expression:"showPreView"}],staticClass:"row justify-center q-mt-md"},[a("div",{staticClass:"col-12"},[a("q-card",[a("q-card-section",{staticClass:"prodTextTitle"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-4"},[e._v("\n              Xem trước \n           ")]),a("div",{staticClass:"col-4",attrs:{align:"right"}},[a("q-btn",{attrs:{color:"secondary","icon-right":"save",label:"Lưu và Gửi Phê Duyệt"},on:{click:e.sendRequest}})],1),a("div",{staticClass:"col-4",attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary","icon-right":"pen",label:"Chỉnh sửa"},on:{click:function(t){e.showPreView=!1}}})],1)])]),a("q-card-section",[a("DxPivotGrid",{ref:"grid",attrs:{id:"pivotgrid","data-source":e.dataSource,"allow-filtering":!0,"show-borders":!0,"show-column-grand-totals":!1,"show-row-grand-totals":!1,"show-row-totals":!1,"show-column-totals":!1}})],1)],1)],1)]),a("div",{staticClass:"row justify-center q-mt-lg"},[a("div",{staticClass:"col-12"},[a("q-card",[a("q-card-section",[a("h5",[e._v("Danh sách yêu cầu của tôi")])]),a("q-card-section",[a("table-request",{attrs:{dataSource:e.dataRequest}})],1)],1)],1)])])},r=[],n=(a("7f7f"),a("20d6"),a("7514"),a("a34a")),s=a.n(n),o=(a("96cf"),a("c973")),c=a.n(o),d=(a("551c"),a("ac6a"),a("cadf"),a("06db"),a("5df3"),a("9fc8"),a("61f7")),l=a("d30a"),u=a("0d06"),p=a("d9b2"),h={components:{DxDataGrid:l["DxDataGrid"],DxColumn:l["DxColumn"],DxEditing:l["DxEditing"],DxLookup:l["DxLookup"],DxPivotGrid:d["DxPivotGrid"],DxFieldChooser:d["DxFieldChooser"],DxRequiredRule:l["DxRequiredRule"],"table-request":u["a"]},data:function(){return{items:[],item:null,itemsDuplicate:[],iTypes:[],iType:null,dTypes:[],dType:null,wTypes:[],wType:null,newPriceList:[],newPricePivortData:[],dataSource:{},showPreView:!1,currentPrices:[],dataRequest:[],regions:[],region:null,reason:""}},created:function(){var e=this;Promise.all([this.loadItems(),this.loadInputType(),this.loadwType(),this.loadDType(),this.loadMyRequest(),this.loadRegion()]).then((function(t){e.loadCurrentPrice()}))},watch:{newPriceList:function(e){}},methods:{sendRequest:function(){var e=this;return c()(s.a.mark((function t(){var a,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$q.loading.show({spinner:p["a"],spinnerColor:"primary",spinnerSize:100}),a={data:e.newPricePivortData,reason:e.reason},t.next=4,e.$store.dispatch("wood/CREATE_REQ_PRICE",a);case 4:if(i=t.sent,!0!==i.meta.success){t.next=14;break}return e.newPricePivortData=[],e.showPreView=!1,e.newPriceList=[],t.next=11,e.loadMyRequest();case 11:e.$q.loading.hide(),t.next=15;break;case 14:e.$q.notify({message:i.meta.messages.message||"ERRRRRRRROOOOOOOOOR!",color:"red",position:"center"});case 15:case"end":return t.stop()}}),t)})))()},preview:function(){var e=this;this.newPricePivortData=[],this.newPriceList.forEach((function(t){var a=t,i={dType:e.dTypes.find((function(e){return e.value===a.DTYPE})),iType:e.iTypes.find((function(e){return e.value===a.ITYPE})),wType:e.wTypes.find((function(e){return e.value===a.WTYPE})),item:e.items.find((function(e){return e.value===a.ItemID}))},r={dTypeCode:i.dType.value,dTypeName:i.dType.label,iTypeID:i.iType.value,iTypeName:i.iType.label,wTypeID:i.wType.value,wTypeName:i.wType.label,itemID:i.item.value,itemName:i.item.label,price:a.PRICE,oldPrice:a.OLD_PRICE,regionId:e.region.value};e.newPricePivortData.push(r)}));var t={fields:[{caption:"ITYPE",width:120,dataField:"iTypeName",area:"row",expanded:!0},{caption:"itemName",dataField:"itemName",area:"row",width:150,expanded:!0},{dataField:"wTypeName",area:"column",expanded:!0},{dataField:"dTypeName",area:"column",expanded:!0},{caption:"ĐG Mới",dataField:"price",dataType:"number",summaryType:"sum",area:"data",format:"fixedPoint"},{caption:"ĐG Hiện tại",dataField:"oldPrice",dataType:"number",summaryType:"sum",area:"data",format:"fixedPoint"}],store:this.newPricePivortData};this.dataSource=t,this.showPreView=!0},loadCurrentPrice:function(){var e=this;return c()(s.a.mark((function t(){var a,i;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={moduleId:e.$store.state.base.moduleSelected.id,regionId:e.region.value},t.next=3,e.$store.dispatch("wood/GET_PRICE_RAW_DATA",a);case 3:i=t.sent,e.currentPrices=i.data;case 5:case"end":return t.stop()}}),t)})))()},inserting:function(e){var t=this,a=e.data;if(this.checkDupplicate(a)){var i=this.currentPrices.findIndex((function(e){return parseInt(e.ITEM_ID)===a.ItemID&&e.WTYPE===a.WTYPE&&e.ITYPE===a.ITYPE&&e.DTYPE_CODE.trim()===a.DTYPE.trim()&&t.region.value===e.REGION_ID}));e.data.OLD_PRICE=i>-1?this.currentPrices[i].PRICE:0}else e.cancel=!0,this.$q.notify({message:"Dữ liệu đã tồn tại !",color:"red",position:"center"})},inserted:function(e){this.newPriceList[this.newPriceList.length-1].ID=this.newPriceList.length;this.newPriceList[this.newPriceList.length-1]},initNewRow:function(){},getFilteredCities:function(e){},checkDupplicate:function(e){var t=this.newPriceList.findIndex((function(t){return t.WTYPE===e.WTYPE&&t.DTYPE===e.DTYPE&&t.ITYPE===e.ITYPE&&t.ItemID===e.ItemID}));return-1===t},onEditorPreparing:function(e){"ID"!==e.dataField&&"OLD_PRICE"!==e.dataField||(e.editorOptions.disabled=!0)},loadRegion:function(){var e=this;return c()(s.a.mark((function t(){var a;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("wood/GET_REGION",e.$store.state.base.moduleSelected.id);case 2:a=t.sent,a.data.forEach((function(t){var a={value:t.ID,label:t.NAME};e.regions.push(a)})),e.regions.length>0&&(e.region=e.regions[0]);case 5:case"end":return t.stop()}}),t)})))()},loadMyRequest:function(){var e=this;return new Promise(function(){var t=c()(s.a.mark((function t(a,i){var r,n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$store.state.base.userInfo.id,t.next=3,e.$store.dispatch("wood/GET_MY_REQUEST",r);case 3:n=t.sent,e.dataRequest=n.data,a(!0);case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())},loadDType:function(){var e=this;return new Promise(function(){var t=c()(s.a.mark((function t(a,i){var r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("wood/GET_DTYPE",e.$store.state.base.moduleSelected.id);case 2:r=t.sent,r.data.forEach((function(t){var a={label:t.NAME,value:t.CODE};e.dTypes.push(a)})),e.dTypes.length>0&&(e.dType=e.dTypes[0]),a(!0);case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())},loadwType:function(){var e=this;return new Promise(function(){var t=c()(s.a.mark((function t(a,i){var r;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("wood/GET_WOOD_TYPE");case 2:r=t.sent,r.data.length>0&&r.data.forEach((function(t){var a={value:t.ID,label:t.NAME};e.wTypes.push(a)})),a(!0);case 5:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())},loadInputType:function(){var e=this;return new Promise(function(){var t=c()(s.a.mark((function t(a,i){var r,n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r={moduleId:e.$store.state.base.moduleSelected.id},t.next=3,e.$store.dispatch("wood/GET_INPUT_TYPE",r);case 3:n=t.sent,n.data.forEach((function(t){var a={label:t.NAME,value:t.ID};e.iTypes.push(a)})),e.iTypes.length>0&&(e.iType=e.iTypes[0]),a(!0);case 7:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())},loadItems:function(){var e=this;return new Promise(function(){var t=c()(s.a.mark((function t(a,i){var r,n;return s.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$store.state.base.moduleSelected.id,t.next=3,e.$store.dispatch("wood/GET_ITEM_BY_MODULE_ID",r);case 3:n=t.sent,n.data.length>0&&(n.data.forEach((function(t){var a={value:t.id,label:t.height+"*"+t.width+"*"+t.length+" ("+t.name+")"};e.items.push(a)})),e.itemsDuplicate=e.items),a(n);case 6:case"end":return t.stop()}}),t)})));return function(e,a){return t.apply(this,arguments)}}())}}},w=h,m=a("2877"),f=a("9989"),v=a("9c40"),P=a("f09f"),T=a("a370"),D=a("ddd8"),x=a("27f9"),y=a("eebe"),g=a.n(y),E=Object(m["a"])(w,i,r,!1,null,null,null);t["default"]=E.exports;g()(E,"components",{QPage:f["a"],QBtn:v["a"],QCard:P["a"],QCardSection:T["a"],QSelect:D["a"],QInput:x["a"]})}}]);