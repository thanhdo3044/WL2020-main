(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[121],{c6a5:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-page",{staticClass:"q-pa-sm"},[n("q-input",{attrs:{outlined:"",dense:""},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.searchQuery,callback:function(t){e.searchQuery=t},expression:"searchQuery"}}),n("div"),e.pos(null).length?n("q-list",{attrs:{separator:"",bordered:""}},e._l(e.pos(e.searchQuery),(function(t,a){return n("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:a,attrs:{clickable:""},on:{click:function(n){return e.showConfirmDialog(t.code)}}},[n("q-item-section",[n("q-item-label",{staticClass:"text-subtitle2"},[e._v("\n          ["+e._s(t.itemCode)+"] - "+e._s(t.itemName)+" ("+e._s(t.itemHeight)+"*"+e._s(t.itemWidth)+"*"+e._s(t.itemLength)+")\n        ")]),n("q-item-label",{attrs:{caption:"",lines:"2"}},[n("q-badge",{attrs:{color:t.loiCongDon?"orange-10":"teal"}},[e._v("\n            "+e._s(t.number.toUpperCase())+" - "+e._s(t.root)+"\n          ")])],1)],1),n("q-item-section",{attrs:{side:"",top:""}},[n("q-badge",{attrs:{color:t.loiCongDon?"orange-10":"teal",label:t.conThucHien}})],1)],1)})),1):n("no-tasks"),n("div",{staticClass:"inline rounded-borders cursor-pointer",staticStyle:{"max-width":"300px"}},[n("div",{staticClass:"fit flex flex-center text-center non-selectable q-pa-md"},[e._v("\n      Công đoạn: ("+e._s(e.congdoan.name)+")\n    ")]),n("q-menu",{attrs:{"touch-position":""}},[n("q-list",{staticStyle:{"min-width":"100px"}},e._l(e.myDepartments,(function(t){return n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.id,attrs:{clickable:""}},[n("q-item-section",{on:{click:function(n){return e.chonCongdoan(t)}}},[e._v("\n            "+e._s(t.name)+"\n          ")])],1)})),1)],1)],1),n("q-dialog",{attrs:{maximized:!1},model:{value:e.card,callback:function(t){e.card=t},expression:"card"}},[e.po?n("q-card",{staticClass:"my-card"},[n("q-card-section",[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",flat:"",icon:"keyboard_arrow_left",label:"Trở lại"}}),n("q-input",{attrs:{readonly:!0,type:"text",label:"Sản phẩm/Chi tiết"},model:{value:e.po.itemName,callback:function(t){e.$set(e.po,"itemName",t)},expression:"po.itemName"}}),n("div",{staticClass:"row"},[n("div",{staticClass:"col-4",attrs:{align:"center"}},[n("q-input",{attrs:{readonly:!0,type:"text",label:"Dầy"},model:{value:e.po.itemHeight,callback:function(t){e.$set(e.po,"itemHeight",t)},expression:"po.itemHeight"}})],1),n("div",{staticClass:"col-4",attrs:{align:"center"}},[n("q-input",{attrs:{readonly:!0,type:"text",label:"Rộng"},model:{value:e.po.itemWidth,callback:function(t){e.$set(e.po,"itemWidth",t)},expression:"po.itemWidth"}})],1),n("div",{staticClass:"col-4",attrs:{align:"center"}},[n("q-input",{attrs:{readonly:!0,type:"text",label:"Dài"},model:{value:e.po.itemLenght,callback:function(t){e.$set(e.po,"itemLenght",t)},expression:"po.itemLenght"}})],1)]),n("q-list",{staticClass:"bg-green-3"},[n("q-item-label",{attrs:{header:""}},[e._v("Phôi có thể xuất")]),e._l(e.po.nguyenLieu,(function(t){return n("div",{key:t.ITEM_ID},[n("q-separator"),n("q-item",[n("q-item-section",[n("q-item-label",{attrs:{caption:"",lines:"2"}},[e._v(e._s(t.NAME)+"\n                  "+e._s(t.HEIGHT*t.WIDTH*t.LENGTH)+":\n                  "),n("q-badge",{attrs:{label:t.ton}})],1)],1)],1)],1)}))],2),n("q-input",{attrs:{readonly:!1,type:"number",label:"Số lượng lỗi"},model:{value:e.defectQty,callback:function(t){e.defectQty=e._n(t)},expression:"defectQty"}}),n("q-list",{staticClass:"bg-red-3"},[n("q-input",{attrs:{readonly:!0,color:"red",type:"text",label:"Lỗi công đoạn"},model:{value:e.po.loiCongDon,callback:function(t){e.$set(e.po,"loiCongDon",t)},expression:"po.loiCongDon"}})],1),n("q-input",{attrs:{readonly:!0,type:"text",label:"Công đoạn nhận"},model:{value:e.po.stepNextName,callback:function(t){e.$set(e.po,"stepNextName",t)},expression:"po.stepNextName"}}),n("q-input",{attrs:{readonly:!0,type:"number",label:"Số tồn có thể xuất"},model:{value:e.po.conTon,callback:function(t){e.$set(e.po,"conTon",e._n(t))},expression:"po.conTon"}}),n("q-input",{attrs:{value:e.po.conThucHien,readonly:!0,type:"text",label:"Số lượng còn phải sản xuất"}}),n("q-input",{attrs:{type:"number",label:"Số lượng ghi nhận"},model:{value:e.confirmQty,callback:function(t){e.confirmQty=e._n(t)},expression:"confirmQty"}})],1),n("q-separator"),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{color:"primary",flat:"",label:"Ghi nhận"},on:{click:function(t){e.secondDialog=!0}}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đóng"}})],1)],1):e._e()],1),n("q-dialog",{attrs:{persistent:"","transition-show":"scale","transition-hide":"scale"},model:{value:e.secondDialog,callback:function(t){e.secondDialog=t},expression:"secondDialog"}},[n("q-card",{staticStyle:{width:"300px"}},[n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("Xác nhận")])]),n("q-card-section",{staticClass:"q-pt-none"},[e.confirmQty?n("p",[e._v("\n          Ghi nhận "),n("q-badge",{attrs:{color:"secondary"}},[e._v(e._s(e.confirmQty))]),e._v(" đạt\n          vào kế hoạch "+e._s(e.po.number)+"\n        ")],1):e._e(),e.defectQty?n("span",{staticStyle:{color:"red"}},[e._v("Lỗi : "+e._s(e.defectQty))]):e._e()]),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy"}}),n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đồng ý",color:"primary"},on:{click:e.add}})],1)],1)],1),n("DialogSuccess",{attrs:{closeDialog2:e.closeDialog2,palletCode:e.packageString,show:e.showSuccess,closeDialog:e.closeSuccessDialog}})],1)},o=[],i=(n("8e6e"),n("8a81"),n("ac6a"),n("cadf"),n("456d"),n("c5f6"),n("7cdf"),n("6762"),n("2fdb"),n("6b54"),n("06db"),n("a481"),n("a34a")),r=n.n(i),s=(n("96cf"),n("c973")),c=n.n(s),l=n("9523"),p=n.n(l),u=(n("7514"),n("2f62")),d=n("fa7d"),h=n("c0af");function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){p()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={data:function(){return{maxCoTheGhiNhan:0,secondDialog:!1,congdoan:null,description:"",searchQuery:"",ghinhan:0,arr:"",card:!1,task:null,standard:0,showSuccess:!1,packageId:"",confirmQty:"",confirmData:"",target:"",defectQty:"",receiptQty:"",historys:[],lenhsanxuat:"",maxQtyConfirm:0,packageString:"",totalDeliver:0,po:{code:"POac705671-03af-46bd-9a1c-4ff54b527987",daNhanTon:null,stepId:"100277",number:"1111",week:45,year:2020,market:null,ngayDongGoi:"2020-11-02T00:00:00.000Z",factoryId:1e5,keHoach:1,loiCongDon:0,xuatTon:0,stepName:"6.HTD - X3",stepNextId:100282,stepNextName:"8.Đóng gói - X3",order:5,itemId:118579,itemCode:"ID-0045",itemName:"SKOGSTA chopping board 35x20 acacia",itemLenght:350,itemWidth:200,itemHeight:25,UNIT_ID:1e5,target:1,ton:0,quantity:null,error:null,status:"Đang sản xuất"}}},created:function(){var e=this;this.myDepartments.length&&(this.congdoan=this.myDepartments.find((function(t){return t.id==e.$route.query.stepId}))||this.myDepartments[0],this.load(this.congdoan.id)),this.$route.query.code&&this.showConfirmDialog(this.$route.query.code)},methods:m(m({},Object(u["b"])("production",["getAllsanpham","getAllKeHoachSanXuatConLais","getPoByCode","addPackage1","getDinhMucs","getTyLeTHs","getlenhsx"])),{},{closeDialog2:function(){var e=this;return c()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.showSuccess=!1,e.card=!1,e.defectQty="",e.confirmQty="",e.description="";case 5:case"end":return t.stop()}}),t)})))()},closeSuccessDialog:function(){var e=this;this.showSuccess=!1,this.confirmQty="",setTimeout((function(){e.$router.push("/tracking-lot-no?code="+e.packageId)}),1e3)},chonCongdoan:function(e){var t=this;return c()(r.a.mark((function n(){return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.congdoan=e,t.searchQuery="",t.load(e.id),t.$router.replace({path:t.$route.fullPath,query:{stepId:e.id}});case 4:case"end":return n.stop()}}),n)})))()},load:function(e){var t=this;return c()(r.a.mark((function n(){return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,t.getTyLeTHs({stepId:e});case 2:return n.next=4,t.getAllKeHoachSanXuatConLais({stepId:e});case 4:return n.next=6,t.getAllsanpham({stepId:e});case 6:case"end":return n.stop()}}),n)})))()},loadlenhsx:function(e,t){var n=this;return c()(r.a.mark((function a(){return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,n.getlenhsx({stepId:e,itemId:t});case 2:n.lenhsanxuat=a.sent;case 3:case"end":return a.stop()}}),a)})))()},unique:function(e){return c()(r.a.mark((function t(){var n,a;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(n=[],a=0;a<e.length;a++)-1===n.indexOf(e[a])&&n.push(e[a]);return t.abrupt("return",n);case 3:case"end":return t.stop()}}),t)})))()},showConfirmDialog:function(e){var t=this;return c()(r.a.mark((function n(){var a;return r.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t.$q.loading.show({message:'Hệ thống đang kiểm tra phôi có thể xuất.<br/><span class="text-primary">Xin vui lòng chờ...</span>'}),a=e,t.$router.replace({path:t.$route.fullPath,query:{stepId:t.congdoan.id}}),n.next=5,t.getPoByCode({code1:a});case 5:t.po=n.sent,t.po&&(t.card=!0),t.$q.loading.hide();case 8:case"end":return n.stop()}}),n)})))()},add:function(){var e=this;return c()(r.a.mark((function t(){var n,a,o;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.defectQty||0,a=e.confirmQty||0,100273!=e.congdoan.id){t.next=7;break}for(e.maxCoTheGhiNhan=e.po.nguyenLieu[0].ton,o=0;o<e.po.nguyenLieu.length;o++)e.maxCoTheGhiNhan>e.po.nguyenLieu[o].ton&&(e.maxCoTheGhiNhan=e.po.nguyenLieu[o].ton);if(!(e.maxCoTheGhiNhan<n+a)){t.next=7;break}return t.abrupt("return",e.$q.dialog({title:"Lỗi",message:"Không đủ nguyên vật liệu để xuất!"}));case 7:if(!(parseFloat(n)+parseFloat(a)>parseFloat((e.po.keHoach+e.po.loiCongDon-e.po.quantity).toFixed(6)))){t.next=11;break}e.$q.dialog({title:"Lỗi",message:"Tổng khối lượng vượt quá kế hoạch!"}),t.next=20;break;case 11:if(!(parseFloat(n)>0)){t.next=14;break}return t.next=14,e.createPackage(100004,n);case 14:if(!(parseFloat(a)>0)){t.next=17;break}return t.next=17,e.createPackage(100026,a);case 17:return console.log("Loa data",e.congdoan.id),t.next=20,e.load(e.congdoan.id);case 20:case"end":return t.stop()}}),t)})))()},createPackage:function(e,t){var n=this;return c()(r.a.mark((function a(){var o,i,s,c;return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log(n.po.stepNextId),o=n.po.stepNextId,100004===e&&(i=n.$store.getters["base/mySources"].find((function(e){return e.id===parseInt(n.po.stepId)})),i&&(o=i.error)),console.log("ton:",n.po.conTon),s={sourceId:n.po.stepId,destinationId:o,itemId:n.po.itemId,quantity:t,tonconlai:n.po.conTon,typeId:e,description:n.description,po:n.po.code},a.next=7,n.addPackage1(s);case 7:c=a.sent,c.meta.success?(n.packageString=c.data[0].id.toString(),n.packageId=c.data[0].id,n.maxQtyConfirm=n.maxQtyConfirm-parseFloat(t),100026===e&&(n.showSuccess=!0),Object(d["o"])()):Object(d["n"])();case 9:case"end":return a.stop()}}),a)})))()}}),components:{DialogSuccess:h["a"],"no-tasks":n("734f").default},computed:m(m(m({},Object(u["c"])("base",["myDepartments"])),Object(u["c"])("production",["pos","isDongBoPhoi","tyLeThucHienByItemId"])),{},{getMaxCapPhoi:function(){return 100},isValidate:function(){return!(this.confirmQty&&(!this.po.stepName.toLowerCase().includes("đóng gói")||this.description))&&!(this.defectQty&&(!this.po.stepName.toLowerCase().includes("đóng gói")||this.description))}}),watch:{defectQty:function(e){parseFloat(e)+parseFloat(this.confirmQty||0)>parseFloat((this.lenhsanxuat.conThucHien+this.po.loiCongDon-this.po.quantity).toFixed(6))&&this.$q.dialog({title:"Lỗi",message:"Tổng khối lượng vượt quá kế hoạch!"}),100005===this.po.UNIT_ID||Number.isInteger(e)||this.$q.dialog({title:"Lỗi",message:"Bạn cần nhập số nguyên!"})},confirmQty:function(e){parseFloat(this.defectQty||0)+parseFloat(e)>parseFloat((this.lenhsanxuat.conThucHien+this.po.loiCongDon-this.po.quantity).toFixed(6))&&this.$q.dialog({title:"Lỗi",message:"Tổng khối lượng vượt quá kế hoạch!"}),100005!==this.po.UNIT_ID&&e&&!Number.isInteger(e)&&this.$q.dialog({title:"Lỗi",message:"Bạn cần nhập số nguyên!"})}}},y=f,b=n("2877"),x=n("9989"),v=n("27f9"),q=n("0016"),k=n("1c1c"),w=n("66e5"),C=n("4074"),D=n("0170"),Q=n("58a8"),I=n("4e73"),_=n("24e8"),N=n("f09f"),T=n("a370"),S=n("9c40"),L=n("eb85"),O=n("4b7e"),$=n("714f"),H=n("7f67"),P=n("eebe"),j=n.n(P),F=Object(b["a"])(y,a,o,!1,null,null,null);t["default"]=F.exports;j()(F,"components",{QPage:x["a"],QInput:v["a"],QIcon:q["a"],QList:k["a"],QItem:w["a"],QItemSection:C["a"],QItemLabel:D["a"],QBadge:Q["a"],QMenu:I["a"],QDialog:_["a"],QCard:N["a"],QCardSection:T["a"],QBtn:S["a"],QSeparator:L["a"],QCardActions:O["a"]}),j()(F,"directives",{Ripple:$["a"],ClosePopup:H["a"]})}}]);