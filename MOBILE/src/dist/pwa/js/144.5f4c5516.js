(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[144],{"2d1b":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"q-pa-md"},[!0===this.$store.state.production.loadItemsDone?i("div",[i("app-bar",[t._v("Xuất Kho Sau Sấy")]),i("div",{staticClass:"row justify-center"},[i("div",{staticClass:"col-12 col-md-6 q-ma-md"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{clearable:"",behavior:"dialog",options:t.prodOrders,label:"Lệnh sản xuất"},on:{input:t.changeProdOrder},model:{value:t.prodOrder,callback:function(e){t.prodOrder=e},expression:"prodOrder"}})],1)]),i("div",{staticClass:"row"},[i("div",{staticClass:"col-12"},[i("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px","text-align":"center"},attrs:{behavior:"dialog",options:t.sources,add:t.changeSource,label:"Kho :"},model:{value:t.sourceSelect,callback:function(e){t.sourceSelect=e},expression:"sourceSelect"}})],1)]),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showSelectDestination,expression:"showSelectDestination"}],staticClass:"row"},[i("div",{staticClass:"col-12"},[i("q-select",{staticStyle:{"font-family":"'Time New Roman'","font-size":"16px"},attrs:{behavior:"dialog",options:t.destinations,label:"Nơi xuất đến :"},model:{value:t.destinationSelect,callback:function(e){t.destinationSelect=e},expression:"destinationSelect"}})],1)]),i("div",{staticClass:"row justify-center q-mt-md "},[null!==this.$store.state.production.itemChoosed&&void 0!==this.$store.state.production.itemChoosed&&void 0!==this.$store.state.production.itemChoosed.id?i("div",{staticClass:"col-12"},[i("card-item-in-from",{attrs:{removeItem:t.removeItem,item:this.$store.state.production.itemChoosed}})],1):t._e()]),i("div",{staticClass:"row q-mt-md gt-md"},[i("div",{staticClass:"col-12"},[i("DxDataGrid",{attrs:{"data-source":t.itemsSelected,"show-borders":!0,"key-expr":"id"},on:{editorPreparing:t.onEditorPreparing,"init-new-row":t.initNewRow,"row-inserted":t.insertedRow,"row-inserting":t.insertingRow}},[i("DxEditing",{attrs:{"allow-deleting":!0,"allow-updating":!0,"use-icons":!0,mode:"popup"}},[i("DxPopup",{attrs:{"show-title":!0,width:700,height:425,title:"Nhập số lượng"}},[i("DxPosition",{attrs:{my:"center",at:"center",of:"window"}})],1)],1),i("DxColumn",{attrs:{"data-field":"name",caption:"Tên sản phẩm",width:"355"}}),i("DxColumn",{attrs:{"data-field":"height",caption:"Dầy",width:"55"}}),i("DxColumn",{attrs:{"data-field":"width",caption:"Rộng",width:"55"}}),i("DxColumn",{attrs:{"data-field":"length",caption:"Dài",width:"60"}}),i("DxColumn",{attrs:{"data-field":"quantity",caption:"Số lượng","data-type":"number",format:"fixedPoint"}},[i("DxRequiredRule")],1)],1)],1)]),i("div",{staticClass:"row justify-center lt-md q-mt-md"},t._l(t.itemsSelected,(function(e,a){return i("div",{key:e.id,staticClass:"col-12 q-ma-sm"},[i("q-card",{staticClass:"my-card"},[i("q-card-section",[i("div",{staticClass:"row"},[i("div",{staticClass:"col-10"},[i("div",{staticClass:"text-h6"},[t._v("("+t._s(a+1)+") - "+t._s(e.name))])]),i("div",{staticClass:"col-1",attrs:{align:"right"}},[i("q-btn",{attrs:{color:"red",round:"",icon:"close"},on:{click:function(e){return t.removeMaterial(a)}}})],1)])]),i("q-card-section",[i("q-input",{attrs:{outlined:"",type:"number",label:"Số lượng xuất"},model:{value:e.quantity,callback:function(i){t.$set(e,"quantity",t._n(i))},expression:"item.quantity"}})],1)],1)],1)})),0),t.validate?i("div",{staticClass:"row justify-center"},[i("div",{staticClass:"col-8 justify-center"},[i("q-btn",{attrs:{color:"primary full-width q-mt-md",glossy:"",label:"Xuất kho"},on:{click:function(e){t.showConfirm=!0}}})],1)]):t._e()])])],1):t._e(),i("dialog-success",{attrs:{show:t.showSuccess,palletCode:t.palletCode,closeDialog:t.closeDialog}}),i("q-dialog",{attrs:{persistent:""},model:{value:t.showConfirm,callback:function(e){t.showConfirm=e},expression:"showConfirm"}},[i("q-card",{staticStyle:{"min-width":"300px"}},[i("q-card-section",{staticClass:"row items-center"},[i("span",{staticClass:"prodTextTitle"},[t._v("Bạn đã chắc chắn ?")])]),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Hủy",color:"primary"}}),i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Đồng ý",color:"primary"},on:{click:t.createPallet}})],1)],1)],1)],1)},o=[],s=(i("6b54"),i("ac6a"),i("cadf"),i("5df3"),i("7f7f"),i("a34a")),n=i.n(s),r=(i("96cf"),i("c973")),l=i.n(r),c=(i("551c"),i("06db"),i("28a5"),i("278c")),d=i.n(c),u=(i("f79b"),i("4778")),p=i("427f"),h=i("dd38"),m=i("9fb5"),f=i("075b"),v=i("c0af"),w=i("8e39"),g=(i("5918"),i("fa7d"),i("d30a")),C={components:{"app-bar":h["a"],"info-factoryfsc":u["a"],"card-itempallet":p["a"],"info-supplies":m["a"],"card-item-in-from":f["a"],"dialog-success":v["a"],"dialog-add-supplies":w["a"],DxDataGrid:g["DxDataGrid"],DxColumn:g["DxColumn"],DxEditing:g["DxEditing"],DxLookup:g["DxLookup"],DxRequiredRule:g["DxRequiredRule"],DxPopup:g["DxPopup"],DxPosition:g["DxPosition"],DxForm:g["DxForm"],DxItem:g["DxItem"]},beforeDestroy:function(){console.log("create pallet page destroy"),this.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET_INIT"),this.item=null,this.removeItem()},beforeMount:function(){this.removeItem()},data:function(){return{text:"",items:[],parcel:"",dialog:!1,item:null,loadDone:0,showLoadling:!0,sources:[],sourceSelect:null,destinations:[],destinationSelect:null,palletTypes:[],palletTypeSelect:null,materials:[],materialSelected:null,requireMaterialSelect:!1,validate:!1,showSuccess:!1,palletCode:"",showDialogAddSupplie:!1,showSelectItem:!1,showSelectDestination:!0,showConfirm:!1,prodOrder:null,prodOrders:[],woodType:null,woodTypes:[],lenhsx:"",requireSelectLSX:!0,itemsSelected:[],receipts:[],receipt:null,itemsInReceipt:[]}},computed:{wathValidate:function(){return"".concat(this.sourceSelect,"|").concat(this.destinationSelect)}},watch:{wathValidate:function(t,e){var i=t.split("|"),a=d()(i,5),o=a[0],s=a[1],n=a[2],r=a[3],l=a[4];"null"!==o&&"null"!==s&&"null"!==n&&"null"!==r?this.requireMaterialSelect?"null"!==mSelect?this.validate=!0:this.validate=!1:"null"!==l&&(this.validate=!0):this.validate=!1},item:function(t){}},created:function(){var t=this,e=this.$store.getters["base/myFactoryInfor"].id,i=new Promise(function(){var e=l()(n.a.mark((function e(i,a){var o;return n.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("wood/GET_RECEIPTS",1);case 2:o=e.sent,o.data.forEach((function(e){var i={label:e.NUMBER_OF_MONTH+"/"+e.MONTH+"."+e.YEAR,value:e.ID};t.receipts.push(i)})),i(!0);case 5:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}()),a=new Promise(function(){var e=l()(n.a.mark((function e(i,a){var o;return n.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("production/ACTION_FETCH_ITEMS_BY_TYPE",100008);case 2:o=e.sent,o.forEach((function(e){t.items.push({value:e.id,label:e.name})})),i(!0);case 5:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}()),o=new Promise(function(){var i=l()(n.a.mark((function i(a,o){var s;return n.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,t.$store.dispatch("production/ACTION_LOAD_PROD_ORDERS_BY_FACTORY",e);case 2:s=i.sent,s.data.forEach((function(e){var i={label:e.name,value:e.id};t.prodOrders.push(i)})),a(!0);case 5:case"end":return i.stop()}}),i)})));return function(t,e){return i.apply(this,arguments)}}());Promise.all([a,i,o]).then((function(e){t.$store.dispatch("production/ACTION_LOAD_DONE_CREATE_PALLET");var i=t.$store.getters["base/mySources"],a=t.$store.getters["base/myDestinations"];i.forEach((function(e){if("stock"===e.type2){var i={label:e.name,value:e.id};t.sources.push(i)}})),t.sources.length>0&&(t.sourceSelect=t.sources[0]),a.forEach((function(e){t.destinations.push({value:e.id,label:e.name})})),t.destinations.length>0?t.destinationSelect=t.destinations[0]:t.$q.notify({message:"Tài khoản chưa được cấu hình !"})})).catch((function(t){console.log(t)}))},methods:{changeProdOrder:function(t){var e=this;return l()(n.a.mark((function i(){var a;return n.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,e.$store.dispatch("wood/LOAD_MATERIAL_IN_PROD",t.value);case 2:a=i.sent,e.itemsSelected=a.data.materials;case 4:case"end":return i.stop()}}),i)})))()},initNewRow:function(){},insertedRow:function(){},onEditorPreparing:function(t){"id"!==t.dataField&&"name"!==t.dataField&&"height"!==t.dataField&&"length"!==t.dataField&&"width"!==t.dataField||(t.editorOptions.disabled=!0)},insertingRow:function(){},blurMaLoGo:function(){localStorage.setItem("malogo",this.parcel)},changeSource:function(t){console.log(t)},toAddSupplies:function(){},closeDialog:function(){console.log("close dialog"),this.$router.push("/")},chooseItem:function(){this.$router.push("/production-items")},removeItem:function(){this.$store.dispatch("production/ACTION_REMOVE_ITEM"),this.item=null},removeMaterial:function(t){this.itemsSelected.splice(0,t)},selectItemById:function(){this.$store.dispatch("production/ACTION_CHOOSE_ITEM",this.item)},selectMaterialById:function(){this.$store.dispatch("production/ACTION_SELECT_ONE_MATERIAL",this.materialSelected)},createPallet:function(){var t=this,e=!1,i="",a="";if(this.itemsSelected.length>0)for(var o=0;o<this.itemsSelected.length;o++){var s=this.itemsSelected[o];s.quantity&&s.quantity>0&&(e=!0,i+=s.id+",",a+=s.quantity+",")}if(this.receipt&&(this.validate=!0),e){var n=this.sourceSelect.value,r=this.destinationSelect.value,l=i.slice(0,-1),c=a.slice(0,-1),d={sourceId:n,destinationId:r,itemId:l,quantity:c,productionOrdersId:this.prodOrder.value},u={eventName:"Tạo Pallet",timeStamp:(new Date).toISOString(),status:0,palletCode:"????????"};this.$store.dispatch("production/ACTION_CREATE_PALLET",d).then((function(e){if(!0===e.meta.success){t.palletCode=e.data[0].code,t.showSuccess=!0,t.removeItem(),t.removeMaterial();var i=t.destinationSelect.value.toString()+"-RECIVED-PALLET",a="Đã nhận được pallet số "+t.palletCode,o="Nhận được pallet từ công đoạn "+t.sourceSelect.label+" chuyển đến công đoạn "+t.destinationSelect.label,s="/#/production-dashboard?code="+t.palletCode;t.$sendFcm(a,o,s,i,{}).then((function(t){console.log("send fcm success",t)})).catch((function(t){console.log("send Error: "+t)})),t.$q.notify({message:"Tạo pallet thành công !",color:"green"}),u.status=1,u.palletCode=e.data[0].code}else u.status=0,t.$q.notify({message:e.meta.messages.message,color:"red"});t.$eventLog(u)}))}else this.$q.notify({message:"Thiếu thông tin, vui lòng kiểm tra lại",color:"red"})},closeConfirmAddSupplie:function(){this.showDialogAddSupplie=!1},searchItem:function(t,e){var i=this,a=[];this.$store.state.production.items.forEach((function(t){var e={label:t.name+" -> "+t.height+" "+t.width+" "+t.length,value:t.id};a.push(e)})),e(""!==t?function(){var e=t.toLowerCase();i.items=a.filter((function(t){var i=t.label;if(i.toString().indexOf(e)>-1)return t}))}:function(){i.items=a})},searchMaterial:function(t,e){var i=this,a=[];this.$store.state.production.woods.forEach((function(t){var e={label:t.name+" -> "+t.height+" "+t.width+" "+t.length,value:t.id};a.push(e)})),e(""!==t?function(){var e=t.toLowerCase();i.materials=a.filter((function(t){var i=t.label;if(i.toString().indexOf(e)>-1)return t}))}:function(){i.materials=a})}}},S=C,x=i("2877"),D=i("9989"),b=i("ddd8"),y=i("f09f"),E=i("a370"),_=i("9c40"),I=i("27f9"),T=i("24e8"),q=i("4b7e"),O=i("7f67"),R=i("eebe"),A=i.n(R),$=Object(x["a"])(S,a,o,!1,null,null,null);e["default"]=$.exports;A()($,"components",{QPage:D["a"],QSelect:b["a"],QCard:y["a"],QCardSection:E["a"],QBtn:_["a"],QInput:I["a"],QDialog:T["a"],QCardActions:q["a"]}),A()($,"directives",{ClosePopup:O["a"]})}}]);